import Feedback from '@site/src/components/Feedback';

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Full node

## Требования к ОС

Мы настоятельно рекомендуем установить mytonctrl с использованием поддерживаемых операционных систем:

- Ubuntu 20.04
- Ubuntu 22.04
- Debian 11

## Требования к аппаратному обеспечению

:::caution Использование узла на персональном локальном компьютере
You shouldn't run any type of node on your personal local machine for extended periods, even if it meets the requirements. Nodes actively use disks, which can lead to rapid wear and potential damage.
:::

### With validator

- 16-ядерный процессор
- 128 ГБ оперативной памяти
- 1TB NVME SSD _OR_ Provisioned 64+k IOPS storage
- Подключение к сети со скоростью 1 Гбит/с
- Общедоступный IP-адрес (фиксированный IP-адрес)
- Трафик 64 ТБ/месяц (100 ТБ/месяц при пиковой нагрузке)

:::info Будьте готовы к пиковым нагрузкам
To reliably handle peak loads, a connection of at least 1 Gbit/s is typically required, while the average load is expected to be around 100 Mbit/s.
:::

### Port forwarding

All types of nodes require a static external IP address, one UDP port forwarded for incoming connections, and all outgoing connections to be open—the node uses random ports for new outgoing connections. The node must also be visible to the outside world over the NAT.

You can accomplish this by contacting your network provider or [renting a server](/v3/guidelines/nodes/running-nodes/full-node#recommended-providers) to run a node.

:::info
Вы можете определить открытый UDP-порт с помощью команды `netstat -tulpn`.
:::

### Recommended providers

TON Foundation рекомендует следующих провайдеров для запуска валидатора:

| Cloud Provider | Instance Type                   | CPU                     | RAM      | Storage                                   | Network         | Public IP                                      | Трафик         |
| -------------- | ------------------------------- | ----------------------- | -------- | ----------------------------------------- | --------------- | ---------------------------------------------- | -------------- |
| GCP            | `n2-standard-16`                | `32 vCPUs`              | `128 ГБ` | `1TB NVMe SSD`                            | `16 Gbps`       | Reserve a static external IP                   | `64 ТБ/месяц`. |
| Alibaba Cloud  | `ecs.g6.4xlarge`                | `32 vCPUs`              | `128 ГБ` | `1TB NVMe SSD`                            | `До 10 Гбит/с`  | Bind an Elastic IP                             | `64 ТБ/месяц`. |
| Tencent Cloud  | `M5.4XLARGE`                    | `32 vCPUs`              | `128 ГБ` | `1TB NVMe SSD`                            | `До 10 Гбит/с`  | Associate an Elastic IP                        | `64 ТБ/месяц`. |
| Vultr          | `bare metal Intel E-2388G`      | `16 ядер / 32 потока`   | `128 ГБ` | `1.92TB NVMe SSD`                         | `10 Gbps`       | Фиксированный IP-адрес, включенный в экземпляр | `64 ТБ/месяц`. |
| DigitalOcean   | `general purpose premium Intel` | `32 vCPUs`              | `128 ГБ` | `1TB NVMe SSD`                            | `10 Gbps`       | Фиксированный IP-адрес, включенный в экземпляр | `64 ТБ/месяц`. |
| Latitude       | `c3.medium.x86`                 | `16 ядер / 32 потока`   | `128 ГБ` | `1.9TB NVMe SSD`                          | `10 Gbps`       | Фиксированный IP-адрес, включенный в экземпляр | `64 ТБ/месяц`. |
| AWS            | `i4i.8xlarge`                   | `32 vCPUs`              | `256 ГБ` | `2 x 3,750 AWS Nitro SSD (фиксированный)` | `До 25 Гбит/с`  | Bind an Elastic IP                             | `64 ТБ/месяц`. |

:::info
**Note:** Prices, configurations, and availability can change. It is recommended to always refer to the official documentation and pricing pages of the respective cloud provider before making any decisions.
:::

## Запуск узла (видео)

[//]: # "<ReactPlayer controls={true} style={{borderRadius:'10pt', margin:'15pt auto', maxWidth: '100%'}} url='/docs/files/TON_nodes.mp4' />"

Пожалуйста, ознакомьтесь с этим пошаговым видео-руководством, чтобы сразу приступить к работе:

<video
  style={{
    borderRadius: "10pt",
    margin: "auto",
    width: "100%",
    maxWidth: "100%",
  }}
  controls={true}
>
  <source src="/files/TON_nodes.mp4" type="video/mp4" />
</video>

## Run a node (text)

### Переключитесь на пользователя без root прав

:::warning
This step is required to successfully install and use MyTonCtrl—don't ignore non-root user creation. Without this step, there will be no errors during installation, but MyTonCtrl will not work properly.
:::

If you don't have a non-root user, you can create one with the following steps (otherwise, skip the first two steps and go to the third).

1. Войдите в систему как пользователь root и создайте нового пользователя:

```bash
sudo adduser <username>
```

2. Добавьте своего пользователя в группу sudo:

```bash
sudo usermod -aG sudo <username>
```

3. Войдите под именем нового пользователя (если вы используете ssh, **необходимо будет завершить текущую сессию и переподключиться с правильным пользователем**)

```bash
ssh <username>@<server-ip-address>
```

### Установите MyTonCtrl

Скачайте и запустите скрипт установки из учетной записи пользователя **без root** привилегий, используя права **sudo**:

<Tabs groupId="operating-systems">
  <TabItem value="ubuntu" label="Ubuntu">

```bash
wget https://raw.githubusercontent.com/ton-blockchain/mytonctrl/master/scripts/install.sh
sudo bash install.sh
```

</TabItem>
  <TabItem value={'debian'} label={'Debian'}>

```bash
wget https://raw.githubusercontent.com/ton-blockchain/mytonctrl/master/scripts/install.sh
su root -c 'bash install.sh'
```

</TabItem>
</Tabs>

- `-d` - **mytonctrl** загрузит [дамп](https://dump.ton.org/) последнего состояния блокчейна.
  Это сократит время синхронизации в несколько раз.
- `-c <path>` - если вы хотите использовать для синхронизации не общедоступные liteservers. _(не обязательно)_
- `-i` - Игнорировать минимальные требования, используйте только для проверки процесса компиляции без реального использования узла.
- `-m` - Режим, может быть `validator` или `liteserver`.
- `-t` - Отключить телеметрию.

**Чтобы использовать testnet**, флагу `-c` должно быть присвоено значение `https://ton.org/testnet-global.config.json`.

Значение по умолчанию для флага `-c` равно `https://ton-blockchain.github.io/global.config.json`, что является конфигурацией по умолчанию для основной сети (mainnet).

### Running the MyTonCtrl

1. Запустите консоль `MyTonCtrl` из **учетной записи локального пользователя, которая была использована при установке**:

```sh
mytonctrl
```

2. Проверьте состояние `MyTonCtrl` с помощью команды `status`:

```sh
status
```

**В testnet** вместо `status` необходимо использовать команду `status fast`.

Должны отобразиться следующие статусы:

- **mytoncore status**: should display in green.
- **local validator status**: should also display in green.
- **local validator out of sync**: initially, a `n/a` string is displayed. As soon as the newly created validator connects with other validators, the number will be around 250k. As synchronization progresses, this number decreases. When it falls below 20, the validator is synchronized.

Пример вывода команды **status**:

![status](/img/docs/nodes-validator/mytonctrl-status.png)

:::caution Убедитесь, что у вас такой же вывод для команды status
Для всех узлов должен появиться раздел **Local Validator status**.
Если это не так, проверьте раздел [устранения неполадок](/v3/guidelines/nodes/nodes-troubleshooting#status-command-displays-without-local-node-section) и [проверьте журналы узла](/v3/guidelines/nodes/running-nodes/full-node#check-the-node-logs).
:::

Please wait until the `Local validator out of sync` status is less than 20 seconds.

When a new node is started, even from a dump, it is important to wait up to 3 hours before the _out of sync_ number begins to decrease. This delay occurs because the node must establish its place in the network and propagate its addresses through the DHT tables, among other processes.

### Удаление mytonctrl

Загрузите скрипт и запустите его:

```bash
sudo bash /usr/src/mytonctrl/scripts/uninstall.sh
```

### Проверьте владельца mytonctrl

Выполните:

```bash
ls -lh /var/ton-work/keys/
```

## Tips & tricks

### Список доступных команд

- Вы можете использовать `help`, чтобы получить список доступных команд:

![Команда Help](/img/docs/full-node/help.jpg)

### Check the MyTonCtrl logs

- To check **MyTonCtrl** logs, open `~/.local/share/mytoncore/mytoncore.log` for a local user or `/usr/local/bin/mytoncore/mytoncore.log` for root.

![Логи](/img/docs/nodes-validator/manual-ubuntu_mytoncore-log.png)

### Проверьте логи узла

В случае сбоя проверьте логи узла:

```bash
tail -f /var/ton-work/log.thread*
```

## Поддержка

Contact technical support with [@ton_node_help](https://t.me/ton_node_help).

<Feedback />
