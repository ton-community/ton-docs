import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Полный узел

:::warning
Эта страница переведена сообществом на русский язык, но нуждается в улучшениях. Если вы хотите принять участие в переводе свяжитесь с [@alexgton](https://t.me/alexgton).
:::

## Требования к ОС

Мы настоятельно рекомендуем установить mytonctrl с использованием поддерживаемых операционных систем:

- Ubuntu 20.04
- Ubuntu 22.04
- Debian 11

## Требования к аппаратному обеспечению

:::caution Использование узла на персональном локальном компьютере
Не следует запускать какой-либо тип узла на вашем персональном локальном компьютере в течение длительного времени, даже если он удовлетворяет требованиям. Узлы активно используют диски и могут быстро их повредить.
:::

### С валидатором

- 16-ядерный процессор
- 128 ГБ оперативной памяти
- Твердотельный накопитель объемом 1 ТБ _или_ Оборудованное хранилище с более 64 000 операций ввода/вывода в секунду (IOPS)
- Подключение к сети со скоростью 1 Гбит/с
- Общедоступный IP-адрес (фиксированный IP-адрес)
- Трафик 64 ТБ/месяц (100 ТБ/месяц при пиковой нагрузке)

:::info Будьте готовы к пиковым нагрузкам
Как правило, для обеспечения надежной работы с пиковыми нагрузками вам потребуется подключение со скоростью не менее 1 Гбит/с (средняя нагрузка, как ожидается, составит около 100 Мбит/с).
:::

### Переадресация портов

Все типы узлов требуют статического внешнего IP-адреса, один UDP-порт для проброса входящих соединений и все исходящие соединения должны быть открыты - узел использует случайные порты для новых исходящих соединений. Необходимо, чтобы узел был виден извне через NAT.

Это можно сделать с помощью вашего сетевого провайдера или [арендовав сервер](/v3/guidelines/nodes/running-nodes/full-node#recommended-providers) для запуска узла.

:::info
Вы можете определить открытый UDP-порт с помощью команды `netstat -tulpn`.
:::

### Рекомендованные провайдеры

TON Foundation рекомендует следующих провайдеров для запуска валидатора:

| Облачный провайдер            | Тип экземпляра                  | CPU                       | RAM      | Хранилище                                 | Сеть           | Общедоступный IP                                | Трафик         |
| ----------------------------- | ------------------------------- | ------------------------- | -------- | ----------------------------------------- | -------------- | ----------------------------------------------- | -------------- |
| GCP                           | `n2-standard-16`                | `32 vCPUs`                | `128 ГБ` | `1 ТБ NVMe SSD`                           | `16 Гбит/с`    | Зарезервируйте статический внешний IP           | `64 ТБ/месяц`. |
| Alibaba Cloud                 | `ecs.g6.4xlarge`                | `32 vCPUs`                | `128 ГБ` | `1 ТБ NVMe SSD`                           | `До 10 Гбит/с` | Выделенный Elastic IP                           | `64 ТБ/месяц`. |
| Tencent Cloud                 | `M5.4XLARGE`                    | `32 vCPUs`                | `128 ГБ` | `1 ТБ NVMe SSD`                           | `До 10 Гбит/с` | Доступ к Elastic IP                             | `64 ТБ/месяц`. |
| Vultr                         | `bare metal Intel E-2388G`      | `16 ядер / 32 потока`     | `128 ГБ` | `1,92 ТБ NVMe SSD`                        | `10 Гбит/с`    | Фиксированный IP-адрес, включенный в экземпляр  | `64 ТБ/месяц`. |
| DigitalOcean                  | `general purpose premium Intel` | `32 vCPUs`                | `128 ГБ` | `1 ТБ NVMe SSD`                           | `10 Гбит/с`    | Фиксированный IP-адрес, включенный в экземпляр  | `64 ТБ/месяц`. |
| Latitude                      | `c3.medium.x86`                 | `16 ядер / 32 потока`     | `128 ГБ` | `1,9 ТБ NVMe SSD`                         | `10 Гбит/с`    | Фиксированный IP-адрес, включенный в экземпляр  | `64 ТБ/месяц`. |
| AWS                           | `i4i.8xlarge`                   | `32 vCPUs`                | `256 ГБ` | `2 x 3,750 AWS Nitro SSD (фиксированный)` | `До 25 Гбит/с` | Выделенный Elastic IP                           | `64 ТБ/месяц`. |

:::info
**Примечание:** Цены, конфигурации и доступность могут отличаться. Рекомендуется всегда проверять официальную документацию и страницы с ценами соответствующего облачного провайдера, прежде чем принимать какие-либо решения.
:::

## Запуск узла (видео)

[//]: # "<ReactPlayer controls={true} style={{borderRadius:'10pt', margin:'15pt auto', maxWidth: '100%'}} url='/docs/files/TON_nodes.mp4' />"

Пожалуйста, ознакомьтесь с этим пошаговым видео-руководством, чтобы сразу приступить к работе:

<video style={{borderRadius:'10pt', margin:'auto', width: '100%', maxWidth: '100%'}} controls={true}>
    <source src="/files/TON_nodes.mp4" type="video/mp4" />
</video>

## Запуск узла (текст)

### Переключитесь на пользователя без root прав

:::warning
Этот шаг **необходим ** для успешной установки и использования mytonctrl — не игнорируйте создание пользователя, без root прав\*\*. Без этого шага ошибок при установке не возникнет, но mytonctrl не будет работать должным образом.
:::

Если у вас нет пользователя **без root** прав, вы можете создать его с помощью следующих шагов (в противном случае пропустите первые два шага и перейдите к третьему).

1. Войдите в систему как пользователь root и создайте нового пользователя:

```bash
sudo adduser <username>
```

2. Добавьте своего пользователя в группу sudo:

```bash
sudo usermod -aG sudo <username>
```

3. Войдите под именем нового пользователя (если вы используете ssh, **необходимо будет завершить текущую сессию и переподключиться с правильным пользователем**)

```bash
ssh <username>@<server-ip-address>
```

### Установите MyTonCtrl

Скачайте и запустите скрипт установки из учетной записи пользователя **без root** привилегий, используя права **sudo**:

<Tabs groupId="operating-systems">
  <TabItem value="ubuntu" label="Ubuntu">

```bash
wget https://raw.githubusercontent.com/ton-blockchain/mytonctrl/master/scripts/install.sh
sudo bash install.sh
```

</TabItem>
  <TabItem value={'debian'} label={'Debian'}>

```bash
wget https://raw.githubusercontent.com/ton-blockchain/mytonctrl/master/scripts/install.sh
su root -c 'bash install.sh'
```

</TabItem>
</Tabs>

- `-d` - **mytonctrl** загрузит [дамп](https://dump.ton.org/) последнего состояния блокчейна.
  Это сократит время синхронизации в несколько раз.
- `-c <path>` - если вы хотите использовать для синхронизации не общедоступные liteservers. _(не обязательно)_
- `-i` - Игнорировать минимальные требования, используйте только для проверки процесса компиляции без реального использования узла.
- `-m` - Режим, может быть `validator` или `liteserver`.
- `-t` - Отключить телеметрию.

**Чтобы использовать testnet**, флагу `-c` должно быть присвоено значение `https://ton.org/testnet-global.config.json`.

Значение по умолчанию для флага `-c` равно `https://ton-blockchain.github.io/global.config.json`, что является конфигурацией по умолчанию для основной сети (mainnet).

### Запуск mytonctrl

1. Запустите консоль `MyTonCtrl` из **учетной записи локального пользователя, которая была использована при установке**:

```sh
mytonctrl
```

2. Проверьте состояние `MyTonCtrl` с помощью команды `status`:

```sh
status
```

**В testnet** вместо `status` необходимо использовать команду `status fast`.

Должны отобразиться следующие статусы:

- **mytoncore status**: Должен быть зеленым.
- **local validator status**: Должен быть также зеленым.
- **local validator out of sync**: Сначала отображается строка `n/a`. Как только вновь созданный валидатор подключится к другим валидаторам, число будет около 250 000. По мере выполнения синхронизации это число уменьшается. Когда оно падает ниже 20, валидатор считается синхронизированным.

Пример вывода команды **status**:

![status](/img/docs/nodes-validator/mytonctrl-status.png)

:::caution Убедитесь, что у вас такой же вывод для команды status
Для всех узлов должен появиться раздел **Local Validator status**.
 Если это не так, проверьте раздел [устранения неполадок](/v3/guidelines/nodes/nodes-troubleshooting#status-command-displays-without-local-node-section) и [проверьте журналы узла](/v3/guidelines/nodes/running-nodes/full-node#check-the-node-logs).
:::

Подождите, пока `Local validator out of sync` не станет меньше 20 секунд.

При запуске нового узла, даже из дампа, **необходимо подождать до 3 часов, прежде чем количество рассинхронизаций начнет уменьшаться**. Это связано с тем, что узел все еще должен установить свое положение в сети и распространить свои адреса через таблицы DHT.

### Удаление mytonctrl

Загрузите скрипт и запустите его:

```bash
sudo bash /usr/src/mytonctrl/uninstall.sh
```

### Проверьте владельца mytonctrl

Выполните:

```bash
ls -lh /var/ton-work/keys/
```

## Советы и рекомендации

### Список доступных команд

- Вы можете использовать `help`, чтобы получить список доступных команд:

![Команда Help](/img/docs/full-node/help.jpg)

### Проверьте логи mytonctrl

- Чтобы проверить логи **mytonctrl**, откройте `~/.local/share/mytoncore/mytoncore.log` для локальной учетной записи или `/usr/local/bin/mytoncore/mytoncore.log` для пользователя Root.

![Логи](/img/docs/nodes-validator/manual-ubuntu_mytoncore-log.png)

### Проверьте логи узла

В случае сбоя проверьте логи узла:

```bash
tail -f /var/ton-work/log.thread*
```

## Поддержка

Обратитесь в службу технической поддержки по ссылке [@mytonctrl_help](https://t.me/mytonctrl_help).
