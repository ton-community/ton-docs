# é€æ­¥åˆ›å»º NFT é›†åˆçš„æ•™ç¨‹

## ğŸ‘‹ å¼•è¨€

éåŒè´¨åŒ–ä»£å¸ï¼ˆNFTï¼‰å·²æˆä¸ºæ•°å­—è‰ºæœ¯å’Œæ”¶è—å“ä¸–ç•Œä¸­æœ€çƒ­é—¨çš„è¯é¢˜ä¹‹ä¸€ã€‚NFTæ˜¯ä½¿ç”¨åŒºå—é“¾æŠ€æœ¯éªŒè¯æ‰€æœ‰æƒå’ŒçœŸå®æ€§çš„ç‹¬ç‰¹æ•°å­—èµ„äº§ã€‚å®ƒä»¬ä¸ºåˆ›ä½œè€…å’Œæ”¶è—å®¶æä¾›äº†å°†æ•°å­—è‰ºæœ¯ã€éŸ³ä¹ã€è§†é¢‘å’Œå…¶ä»–å½¢å¼çš„æ•°å­—å†…å®¹è´§å¸åŒ–å’Œäº¤æ˜“çš„æ–°å¯èƒ½æ€§ã€‚è¿‘å¹´æ¥ï¼ŒNFTå¸‚åœºçˆ†ç‚¸æ€§å¢é•¿ï¼Œä¸€äº›é«˜è°ƒçš„é”€å”®é¢è¾¾åˆ°äº†æ•°ç™¾ä¸‡ç¾å…ƒã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†é€æ­¥åœ¨TONä¸Šæ„å»ºæˆ‘ä»¬çš„NFTé›†åˆã€‚

**è¿™æ˜¯ä½ åœ¨æœ¬æ•™ç¨‹ç»“æŸæ—¶å°†åˆ›å»ºçš„é¸­å­é›†åˆçš„ç²¾ç¾å›¾ç‰‡ï¼š**

![](/img/tutorials/nft/collection.png)

## ğŸ¦„ ä½ å°†ä¼šå­¦åˆ°ä»€ä¹ˆ

1. ä½ å°†åœ¨TONä¸Šé“¸é€ NFTé›†åˆ
2. ä½ å°†ç†è§£TONä¸Šçš„NFTæ˜¯å¦‚ä½•å·¥ä½œçš„
3. ä½ å°†æŠŠNFTå‡ºå”®
4. ä½ å°†æŠŠå…ƒæ•°æ®ä¸Šä¼ åˆ°[pinata.cloud](https://pinata.cloud)

## ğŸ’¡ å¿…è¦æ¡ä»¶

ä½ å¿…é¡»å·²ç»æœ‰ä¸€ä¸ªæµ‹è¯•ç½‘é’±åŒ…ï¼Œé‡Œé¢è‡³å°‘æœ‰2 TONã€‚å¯ä»¥ä»[@testgiver_ton_bot](https://t.me/testgiver_ton_bot)è·å–æµ‹è¯•ç½‘å¸ã€‚

:::info å¦‚ä½•æ‰“å¼€æˆ‘çš„Tonkeeperé’±åŒ…çš„æµ‹è¯•ç½‘ç‰ˆæœ¬ï¼Ÿ\
è¦åœ¨tonkeeperä¸­æ‰“å¼€æµ‹è¯•ç½‘ç½‘ç»œï¼Œè¯·è½¬åˆ°è®¾ç½®å¹¶ç‚¹å‡»ä½äºåº•éƒ¨çš„tonkeeper logo 5æ¬¡ï¼Œä¹‹åé€‰æ‹©æµ‹è¯•ç½‘è€Œä¸æ˜¯ä¸»ç½‘ã€‚
:::

æˆ‘ä»¬å°†ä½¿ç”¨Pinataä½œä¸ºæˆ‘ä»¬çš„IPFSå­˜å‚¨ç³»ç»Ÿï¼Œå› æ­¤ä½ è¿˜éœ€è¦åœ¨[pinata.cloud](https://pinata.cloud)ä¸Šåˆ›å»ºä¸€ä¸ªå¸æˆ·å¹¶è·å–api_key & api_secreatã€‚å®˜æ–¹Pinata [æ–‡æ¡£æ•™ç¨‹](https://docs.pinata.cloud/pinata-api/authentication)å¯ä»¥å¸®åŠ©å®Œæˆè¿™ä¸€ç‚¹ã€‚åªè¦ä½ æ‹¿åˆ°è¿™äº›apiä»¤ç‰Œï¼Œæˆ‘å°±åœ¨è¿™é‡Œç­‰ä½ ï¼ï¼ï¼

## ğŸ’ ä»€ä¹ˆæ˜¯ TON ä¸Šçš„ NFT?

åœ¨å¼€å§‹æˆ‘ä»¬æ•™ç¨‹çš„ä¸»è¦éƒ¨åˆ†ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ä¸€ä¸‹é€šå¸¸æ„ä¹‰ä¸ŠTONä¸­NFTæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚å‡ºä¹æ„æ–™çš„æ˜¯ï¼Œæˆ‘ä»¬å°†ä»è§£é‡ŠETHä¸­NFTçš„å·¥ä½œåŸç†å¼€å§‹ï¼Œä¸ºäº†ç†è§£TONä¸­NFTå®ç°çš„ç‰¹æ®Šæ€§ï¼Œä¸è¡Œä¸šä¸­å¸¸è§çš„åŒºå—é“¾ç›¸æ¯”ã€‚

### ETH ä¸Šçš„ NFT å®ç°

ETHä¸­NFTçš„å®ç°æå…¶ç®€å• - å­˜åœ¨1ä¸ªä¸»è¦çš„é›†åˆåˆçº¦ï¼Œå®ƒå­˜å‚¨ä¸€ä¸ªç®€å•çš„å“ˆå¸Œæ˜ å°„ï¼Œè¯¥å“ˆå¸Œæ˜ å°„åè¿‡æ¥å­˜å‚¨æ­¤é›†åˆä¸­NFTçš„æ•°æ®ã€‚æ‰€æœ‰ä¸æ­¤é›†åˆç›¸å…³çš„è¯·æ±‚ï¼ˆå¦‚æœä»»ä½•ç”¨æˆ·æƒ³è¦è½¬ç§»NFTã€å°†å…¶å‡ºå”®ç­‰ï¼‰éƒ½ç‰¹åˆ«å‘é€åˆ°æ­¤1ä¸ªé›†åˆåˆçº¦ã€‚

![](/img/tutorials/nft/eth-collection.png)

### åœ¨ TON ä¸­å¦‚æ­¤å®ç°å¯èƒ½å‡ºç°çš„é—®é¢˜

åœ¨TONçš„ä¸Šä¸‹æ–‡ä¸­ï¼Œæ­¤ç±»å®ç°çš„é—®é¢˜ç”±[TONçš„NFTæ ‡å‡†](https://github.com/ton-blockchain/TEPs/blob/master/text/0062-nft-standard.md)å®Œç¾æè¿°ï¼š

- ä¸å¯é¢„æµ‹çš„ç‡ƒæ–™æ¶ˆè€—ã€‚åœ¨TONä¸­ï¼Œå­—å…¸æ“ä½œçš„ç‡ƒæ–™æ¶ˆè€—å–å†³äºç¡®åˆ‡çš„é”®é›†ã€‚æ­¤å¤–ï¼ŒTONæ˜¯ä¸€ä¸ªå¼‚æ­¥åŒºå—é“¾ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœä½ å‘ä¸€ä¸ªæ™ºèƒ½åˆçº¦å‘é€ä¸€ä¸ªæ¶ˆæ¯ï¼Œé‚£ä¹ˆä½ ä¸çŸ¥é“æœ‰å¤šå°‘æ¥è‡ªå…¶ä»–ç”¨æˆ·çš„æ¶ˆæ¯ä¼šåœ¨ä½ çš„æ¶ˆæ¯ä¹‹å‰åˆ°è¾¾æ™ºèƒ½åˆçº¦ã€‚å› æ­¤ï¼Œä½ ä¸çŸ¥é“å½“ä½ çš„æ¶ˆæ¯åˆ°è¾¾æ™ºèƒ½åˆçº¦æ—¶å­—å…¸çš„å¤§å°ä¼šæ˜¯å¤šå°‘ã€‚è¿™å¯¹äºç®€å•çš„é’±åŒ… -> NFTæ™ºèƒ½åˆçº¦äº¤äº’æ˜¯å¯ä»¥çš„ï¼Œä½†å¯¹äºæ™ºèƒ½åˆçº¦é“¾ï¼Œä¾‹å¦‚é’±åŒ… -> NFTæ™ºèƒ½åˆçº¦ -> æ‹å– -> NFTæ™ºèƒ½åˆçº¦ï¼Œåˆ™ä¸å¯æ¥å—ã€‚å¦‚æœæˆ‘ä»¬ä¸èƒ½é¢„æµ‹ç‡ƒæ–™æ¶ˆè€—ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šå‡ºç°è¿™æ ·çš„æƒ…å†µï¼šNFTæ™ºèƒ½åˆçº¦ä¸Šçš„æ‰€æœ‰è€…å·²ç»æ›´æ”¹ï¼Œä½†æ‹å–æ“ä½œæ²¡æœ‰è¶³å¤Ÿçš„Toncoinã€‚ä¸ä½¿ç”¨å­—å…¸çš„æ™ºèƒ½åˆçº¦å¯ä»¥æä¾›ç¡®å®šæ€§çš„ç‡ƒæ–™æ¶ˆè€—ã€‚

- ä¸å¯æ‰©å±•ï¼ˆæˆä¸ºç“¶é¢ˆï¼‰ã€‚TONçš„æ‰©å±•æ€§åŸºäºåˆ†ç‰‡çš„æ¦‚å¿µï¼Œå³åœ¨è´Ÿè½½ä¸‹è‡ªåŠ¨å°†ç½‘ç»œåˆ’åˆ†ä¸ºåˆ†ç‰‡é“¾ã€‚æµè¡ŒNFTçš„å•ä¸ªå¤§æ™ºèƒ½åˆçº¦ä¸è¿™ä¸€æ¦‚å¿µç›¸çŸ›ç›¾ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè®¸å¤šäº¤æ˜“å°†å¼•ç”¨ä¸€ä¸ªå•ä¸€çš„æ™ºèƒ½åˆçº¦ã€‚TONæ¶æ„ä¸ºåˆ†ç‰‡çš„æ™ºèƒ½åˆçº¦æä¾›äº†è®¾æ–½ï¼ˆå‚è§ç™½çš®ä¹¦ï¼‰ï¼Œä½†ç›®å‰å°šæœªå®ç°ã€‚

*ç®€è€Œè¨€ä¹‹ï¼ŒETHçš„è§£å†³æ–¹æ¡ˆä¸å¯æ‰©å±•ä¸”ä¸é€‚ç”¨äºåƒTONè¿™æ ·çš„å¼‚æ­¥åŒºå—é“¾ã€‚*

### TON ä¸Šçš„ NFT å®ç°

åœ¨TONä¸­ï¼Œæˆ‘ä»¬æœ‰1ä¸ªä¸»åˆçº¦-æˆ‘ä»¬é›†åˆçš„æ™ºèƒ½åˆçº¦ï¼Œå®ƒå­˜å‚¨å®ƒçš„å…ƒæ•°æ®å’Œå®ƒæ‰€æœ‰è€…çš„åœ°å€ï¼Œä»¥åŠæœ€é‡è¦çš„ - å¦‚æœæˆ‘ä»¬æƒ³è¦åˆ›å»ºï¼ˆ"é“¸é€ "ï¼‰æ–°çš„NFTé¡¹ç›® - æˆ‘ä»¬åªéœ€è¦å‘è¿™ä¸ªé›†åˆåˆçº¦å‘é€æ¶ˆæ¯ã€‚è€Œè¿™ä¸ªé›†åˆåˆçº¦å°†ä¸ºæˆ‘ä»¬éƒ¨ç½²æ–°NFTé¡¹ç›®çš„åˆçº¦ï¼Œå¹¶æä¾›æˆ‘ä»¬æä¾›çš„æ•°æ®ã€‚

![](/img/tutorials/nft/ton-collection.png)

:::info
å¦‚æœä½ æƒ³æ›´æ·±å…¥åœ°äº†è§£è¿™ä¸ªè¯é¢˜ï¼Œå¯ä»¥æŸ¥çœ‹[TONä¸Šçš„NFTå¤„ç†](/develop/dapps/asset-processing/nfts)æ–‡ç« æˆ–é˜…è¯»[NFTæ ‡å‡†](https://github.com/ton-blockchain/TEPs/blob/master/text/0062-nft-standard.md)
:::

## âš™ è®¾ç½®å¼€å‘ç¯å¢ƒ

è®©æˆ‘ä»¬ä»åˆ›å»ºä¸€ä¸ªç©ºé¡¹ç›®å¼€å§‹ï¼š

1. åˆ›å»ºæ–°æ–‡ä»¶å¤¹
   `mkdir MintyTON`

```bash
mkdir MintyTON
```

2. å°†ä»¥ä¸‹é…ç½®å¤åˆ¶åˆ°tsconfig.jsonä¸­

```bash
cd MintyTON
```

3. å‘package.jsonæ·»åŠ è„šæœ¬ä»¥æ„å»ºå¹¶å¯åŠ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åº

```bash
yarn init -y
```

4. å®‰è£…æ‰€éœ€çš„åº“

```bash
yarn add typescript @types/node -D
```

5. åˆ›å»º`.env`æ–‡ä»¶å¹¶æ ¹æ®æ­¤æ¨¡æ¿æ·»åŠ ä½ è‡ªå·±çš„æ•°æ®

```bash
tsc --init
```

6. å°†ä»¥ä¸‹é…ç½®å¤åˆ¶åˆ°tsconfig.jsonä¸­

```json
{
    "compilerOptions": {
      "module": "commonjs",
      "target": "es6",
      "lib": ["ES2022"],
      "moduleResolution": "node",
      "sourceMap": true,
      "outDir": "dist",
      "baseUrl": "src",
      "emitDecoratorMetadata": true,
      "experimentalDecorators": true,
      "strict": true,
      "esModuleInterop": true,
      "strictPropertyInitialization": false
    },
    "include": ["src/**/*"]
}
```

7. åœ¨ `package.json` ä¸­æ·»åŠ è„šæœ¬ä»¥æ„å»ºå’Œå¯åŠ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åº

```json
"scripts": {
    "start": "tsc --skipLibCheck && node dist/app.js"
  },
```

8. å®‰è£…æ‰€éœ€çš„åº“

```bash
yarn add @pinata/sdk dotenv @ton/ton @ton/crypto @ton/core buffer
```

9. åˆ›å»º`.env`æ–‡ä»¶å¹¶æ ¹æ®æ­¤æ¨¡æ¿æ·»åŠ ä½ è‡ªå·±çš„æ•°æ®

```
PINATA_API_KEY=your_api_key
PINATA_API_SECRET=your_secret_api_key
MNEMONIC=word1 word2 word3 word4
TONCENTER_API_KEY=aslfjaskdfjasasfas
```

æœ€åæ‰“å¼€æˆ‘ä»¬çš„é’±åŒ…ï¼š

å¤ªå¥½äº†ï¼ç°åœ¨æˆ‘ä»¬å‡†å¤‡å¥½å¼€å§‹ä¸ºæˆ‘ä»¬çš„é¡¹ç›®ç¼–å†™ä»£ç äº†ã€‚

### ç¼–å†™è¾…åŠ©å‡½æ•°

é¦–å…ˆï¼Œè®©æˆ‘ä»¬åœ¨ `src/utils.ts` ä¸­åˆ›å»ºå‡½æ•° `openWallet`ï¼Œå®ƒå°†é€šè¿‡åŠ©è®°ç¬¦æ‰“å¼€æˆ‘ä»¬çš„é’±åŒ…ï¼Œå¹¶è¿”å›é’±åŒ…çš„å…¬é’¥/å¯†é’¥ã€‚

æœ€åï¼Œè®©æˆ‘ä»¬åˆ›å»º`delay.ts`æ–‡ä»¶ï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªå‡½æ•°æ¥ç­‰å¾…`seqno`å¢åŠ ã€‚

```ts
import { KeyPair, mnemonicToPrivateKey } from "@ton/crypto";
import { beginCell, Cell, OpenedContract} from "@ton/core";
import { TonClient, WalletContractV4 } from "@ton/ton";

export type OpenedWallet = {
  contract: OpenedContract<WalletContractV4>;
  keyPair: KeyPair;
};

export async function openWallet(mnemonic: string[], testnet: boolean) {
  const keyPair = await mnemonicToPrivateKey(mnemonic);
```

åˆ›å»ºä¸€ä¸ªç±»å®ä¾‹ä»¥ä¸toncenteräº¤äº’ï¼š

```ts
  const toncenterBaseEndpoint: string = testnet
    ? "https://testnet.toncenter.com"
    : "https://toncenter.com";

  const client = new TonClient({
    endpoint: `${toncenterBaseEndpoint}/api/v2/jsonRPC`,
    apiKey: process.env.TONCENTER_API_KEY,
  });
```

å…ƒæ•°æ® - åªæ˜¯ä¸€äº›ç®€å•çš„ä¿¡æ¯ï¼Œå°†æè¿°æˆ‘ä»¬çš„NFTæˆ–é›†åˆã€‚ä¾‹å¦‚å®ƒçš„åç§°ã€å®ƒçš„æè¿°ç­‰ã€‚

```ts
  const wallet = WalletContractV4.create({
      workchain: 0,
      publicKey: keyPair.publicKey,
    });

  const contract = client.open(wallet);
  return { contract, keyPair };
}
```

å¾ˆå¥½ï¼Œä¹‹åæˆ‘ä»¬å°†åˆ›å»ºé¡¹ç›®çš„ä¸»å…¥å£ç‚¹ - `src/app.ts`ã€‚
è¿™é‡Œå°†ä½¿ç”¨åˆšåˆšåˆ›å»ºçš„å‡½æ•° `openWallet` å¹¶è°ƒç”¨æˆ‘ä»¬çš„ä¸»å‡½æ•° `init`ã€‚
ç°åœ¨å°±åˆ°æ­¤ä¸ºæ­¢ã€‚

```ts
import * as dotenv from "dotenv";

import { openWallet } from "./utils";
import { readdir } from "fs/promises";

dotenv.config();

async function init() {
  const wallet = await openWallet(process.env.MNEMONIC!.split(" "), true);  
}

void init();
```

æœ€åï¼Œè®©æˆ‘ä»¬åœ¨ `src` ç›®å½•ä¸­åˆ›å»º `delay.ts` æ–‡ä»¶ï¼Œåœ¨è¯¥æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªå‡½æ•°æ¥ç­‰å¾… `seqno` çš„å¢åŠ ã€‚

```ts
import { OpenedWallet } from "./utils";

export async function waitSeqno(seqno: number, wallet: OpenedWallet) {
  for (let attempt = 0; attempt < 10; attempt++) {
    await sleep(2000);
    const seqnoAfter = await wallet.contract.getSeqno();
    if (seqnoAfter == seqno + 1) break;
  }
}

export function sleep(ms: number): Promise<void> {
  return new Promise((resolve) => setTimeout(resolve, ms));
}
```

:::info ä»€ä¹ˆæ˜¯seqno?
ç®€å•æ¥è¯´ï¼Œseqnoå°±æ˜¯ç”±é’±åŒ…å‘é€çš„å¤–éƒ¨äº¤æ˜“çš„è®¡æ•°å™¨ã€‚
Seqnoç”¨äºé¢„é˜²é‡æ”¾æ”»å‡»ã€‚å½“äº¤æ˜“å‘é€åˆ°é’±åŒ…æ™ºèƒ½åˆçº¦æ—¶ï¼Œå®ƒå°†äº¤æ˜“çš„seqnoå­—æ®µä¸å…¶å­˜å‚¨ä¸­çš„å­—æ®µè¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœå®ƒä»¬åŒ¹é…ï¼Œäº¤æ˜“è¢«æ¥å—å¹¶ä¸”å­˜å‚¨çš„seqnoå¢åŠ ä¸€ã€‚å¦‚æœå®ƒä»¬ä¸åŒ¹é…ï¼Œäº¤æ˜“è¢«ä¸¢å¼ƒã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦åœ¨æ¯æ¬¡å‘é€å¤–éƒ¨äº¤æ˜“åç¨ç­‰ä¸€ä¼šå„¿ã€‚
:::

## ğŸ–¼ å‡†å¤‡å…ƒæ•°æ®

è¯·æ³¨æ„ï¼Œæˆ‘ä»¬æ²¡æœ‰å†™"image"å‚æ•°ï¼Œç¨åä½ ä¼šçŸ¥é“åŸå› ï¼Œè¯·ç¨ç­‰ï¼

åœ¨åˆ›å»ºäº†é›†åˆçš„å…ƒæ•°æ®æ–‡ä»¶ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºæˆ‘ä»¬NFTçš„å…ƒæ•°æ®ã€‚

### NFT è§„èŒƒ

TON ä¸Šçš„å¤§å¤šæ•°äº§å“éƒ½æ”¯æŒæ­¤ç±»å…ƒæ•°æ®è§„èŒƒï¼Œä»¥å­˜å‚¨æœ‰å…³ NFT æ”¶é›†çš„ä¿¡æ¯ï¼š

| åç§°                                | è§£é‡Š                                          |
| --------------------------------- | ------------------------------------------- |
| name                              | é›†åˆåç§°                                        |
| description                       | é›†åˆæè¿°                                        |
| image                             | å°†æ˜¾ç¤ºä¸ºå¤´åƒçš„å›¾ç‰‡é“¾æ¥ã€‚æ”¯æŒçš„é“¾æ¥æ ¼å¼ï¼šhttpsã€ipfsã€TON Storageã€‚ |
| cover_image  | å°†æ˜¾ç¤ºä¸ºé›†åˆå°é¢å›¾ç‰‡çš„å›¾ç‰‡é“¾æ¥ã€‚                            |
| social_links | é¡¹ç›®ç¤¾äº¤åª’ä½“é…ç½®æ–‡ä»¶çš„é“¾æ¥åˆ—è¡¨ã€‚ä½¿ç”¨ä¸è¶…è¿‡10ä¸ªé“¾æ¥ã€‚                 |

![image](/img/tutorials/nft/collection-metadata.png)

ä¹‹åï¼Œä½ å¯ä»¥æ ¹æ®éœ€è¦åˆ›å»ºå°½å¯èƒ½å¤šçš„NFTé¡¹ç›®åŠå…¶å…ƒæ•°æ®æ–‡ä»¶ã€‚

```json
{
  "name": "Ducks on TON",
  "description": "This collection is created for showing an example of minting NFT collection on TON. You can support creator by buying one of this NFT.",
  "social_links": ["https://t.me/DucksOnTON"]
}
```

ç°åœ¨è®©æˆ‘ä»¬ç¼–å†™ä¸€äº›ä»£ç ï¼Œå°†æˆ‘ä»¬çš„å…ƒæ•°æ®æ–‡ä»¶ä¸Šä¼ åˆ°IPFSã€‚åˆ›å»º `metadata.ts` æ–‡ä»¶å¹¶æ·»åŠ æ‰€éœ€çš„å¯¼å…¥ï¼š

åœ¨åˆ›å»ºäº†é›†åˆçš„å…ƒæ•°æ®æ–‡ä»¶ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºæˆ‘ä»¬NFTçš„å…ƒæ•°æ®ã€‚

ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å°†æŠŠæˆ‘ä»¬æ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰æ–‡ä»¶å®é™…ä¸Šä¼ åˆ°IPFSï¼š

| åç§°                                | è§£é‡Š                                                                                                            |
| --------------------------------- | ------------------------------------------------------------------------------------------------------------- |
| name                              | NFTåç§°ã€‚æ¨èé•¿åº¦ï¼šä¸è¶…è¿‡15-30ä¸ªå­—ç¬¦                                                                                        |
| description                       | NFTæè¿°ã€‚æ¨èé•¿åº¦ï¼šä¸è¶…è¿‡500ä¸ªå­—ç¬¦                                                                                          |
| image                             | NFTå›¾ç‰‡é“¾æ¥ã€‚                                                                                                      |
| attributes                        | NFTå±æ€§ã€‚å±æ€§åˆ—è¡¨ï¼Œå…¶ä¸­æŒ‡å®šäº†trait_type (å±æ€§åç§°)å’Œvalue (å±æ€§çš„ç®€çŸ­æè¿°)ã€‚ |
| lottie                            | LottieåŠ¨ç”»çš„jsonæ–‡ä»¶é“¾æ¥ã€‚å¦‚æœæŒ‡å®šï¼Œåœ¨NFTé¡µé¢å°†æ’­æ”¾æ¥è‡ªæ­¤é“¾æ¥çš„LottieåŠ¨ç”»ã€‚                                                               |
| content_url  | é¢å¤–å†…å®¹çš„é“¾æ¥ã€‚                                                                                                      |
| content_type | é€šè¿‡content_urlé“¾æ¥æ·»åŠ çš„å†…å®¹çš„ç±»å‹ã€‚ä¾‹å¦‚ï¼Œè§†é¢‘/mp4æ–‡ä»¶ã€‚                                                     |

å¤ªæ£’äº†ï¼è®©æˆ‘ä»¬å›åˆ°ä¹‹å‰çš„é—®é¢˜ï¼šä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨å…ƒæ•°æ®æ–‡ä»¶ä¸­ç•™ä¸‹äº†â€œimageâ€å­—æ®µä¸ºç©ºï¼Ÿæƒ³è±¡ä¸€ä¸‹ä½ æƒ³åœ¨ä½ çš„é›†åˆä¸­åˆ›å»º1000ä¸ªNFTï¼Œå¹¶ä¸”ä½ å¿…é¡»æ‰‹åŠ¨éå†æ¯ä¸ªé¡¹ç›®å¹¶æ‰‹åŠ¨æ’å…¥å›¾ç‰‡é“¾æ¥ã€‚
è¿™çœŸçš„å¾ˆä¸æ–¹ä¾¿ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥è‡ªåŠ¨å®Œæˆè¿™ä¸ªæ“ä½œï¼

```json
{
  "name": "Duck #00",
  "description": "What about a round of golf?",
  "attributes": [{ "trait_type": "Awesomeness", "value": "Super cool" }]
}
```

è¿™é‡Œæˆ‘ä»¬é¦–å…ˆè¯»å–æŒ‡å®šæ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰æ–‡ä»¶ï¼š

### ä¸Šä¼ å…ƒæ•°æ®

éå†æ¯ä¸ªæ–‡ä»¶å¹¶è·å–å…¶å†…å®¹

```ts
import pinataSDK from "@pinata/sdk";
import { readdirSync } from "fs";
import { writeFile, readFile } from "fs/promises";
import path from "path";
```

ä¹‹åï¼Œå¦‚æœä¸æ˜¯æ–‡ä»¶å¤¹ä¸­çš„æœ€åä¸€ä¸ªæ–‡ä»¶ï¼Œæˆ‘ä»¬å°†å›¾åƒå­—æ®µçš„å€¼åˆ†é…ä¸º `ipfs://{IpfsHash}/{index}.jpg`ï¼Œå¦åˆ™ä¸º `ipfs://{imagesIpfsHash}/logo.jpg` å¹¶å®é™…ç”¨æ–°æ•°æ®é‡å†™æˆ‘ä»¬çš„æ–‡ä»¶ã€‚

```ts
export async function uploadFolderToIPFS(folderPath: string): Promise<string> {
  const pinata = new pinataSDK({
    pinataApiKey: process.env.PINATA_API_KEY,
    pinataSecretApiKey: process.env.PINATA_API_SECRET,
  });

  const response = await pinata.pinFromFS(folderPath);
  return response.IpfsHash;
}
```

å¤ªæ£’äº†ï¼è®©æˆ‘ä»¬å›åˆ°ä¹‹å‰çš„é—®é¢˜ï¼šä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨å…ƒæ•°æ®æ–‡ä»¶ä¸­ç•™ä¸‹äº†â€œimageâ€å­—æ®µä¸ºç©ºï¼Ÿæƒ³è±¡ä¸€ä¸‹ä½ æƒ³åœ¨ä½ çš„é›†åˆä¸­åˆ›å»º1000ä¸ªNFTï¼Œå¹¶ä¸”ä½ å¿…é¡»æ‰‹åŠ¨éå†æ¯ä¸ªé¡¹ç›®å¹¶æ‰‹åŠ¨æ’å…¥å›¾ç‰‡é“¾æ¥ã€‚
è¿™çœŸçš„å¾ˆä¸æ–¹ä¾¿ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥è‡ªåŠ¨å®Œæˆè¿™ä¸ªæ“ä½œï¼

```ts
export async function updateMetadataFiles(metadataFolderPath: string, imagesIpfsHash: string): Promise<void> {
  const files = readdirSync(metadataFolderPath);

  await Promise.all(files.map(async (filename, index) => {
    const filePath = path.join(metadataFolderPath, filename)
    const file = await readFile(filePath);
    
    const metadata = JSON.parse(file.toString());
    metadata.image =
      index != files.length - 1
        ? `ipfs://${imagesIpfsHash}/${index}.jpg`
        : `ipfs://${imagesIpfsHash}/logo.jpg`;
    
    await writeFile(filePath, JSON.stringify(metadata));
  }));
}
```

è¿™é‡Œæˆ‘ä»¬é¦–å…ˆè¯»å–æŒ‡å®šæ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰æ–‡ä»¶ï¼š

```ts
const files = readdirSync(metadataFolderPath);
```

éå†æ¯ä¸ªæ–‡ä»¶å¹¶è·å–å…¶å†…å®¹

```ts
const filePath = path.join(metadataFolderPath, filename)
const file = await readFile(filePath);

const metadata = JSON.parse(file.toString());
```

ä¹‹åï¼Œå¦‚æœä¸æ˜¯æ–‡ä»¶å¤¹ä¸­çš„æœ€åä¸€ä¸ªæ–‡ä»¶ï¼Œæˆ‘ä»¬å°†å›¾åƒå­—æ®µçš„å€¼åˆ†é…ä¸º `ipfs://{IpfsHash}/{index}.jpg`ï¼Œå¦åˆ™ä¸º `ipfs://{imagesIpfsHash}/logo.jpg` å¹¶å®é™…ç”¨æ–°æ•°æ®é‡å†™æˆ‘ä»¬çš„æ–‡ä»¶ã€‚

æˆ‘ä»¬å¦‚ä½•å°†é“¾æ¥åˆ°æ™ºèƒ½åˆçº¦ä¸­å­˜å‚¨çš„å…ƒæ•°æ®æ–‡ä»¶ï¼Ÿè¿™ä¸ªé—®é¢˜å¯ä»¥é€šè¿‡[Token Data æ ‡å‡†](https://github.com/ton-blockchain/TEPs/blob/master/text/0064-token-data-standard.md)å¾—åˆ°å®Œå…¨å›ç­”ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä»…ä»…æä¾›æ‰€éœ€çš„æ ‡å¿—å¹¶ä»¥ASCIIå­—ç¬¦æä¾›é“¾æ¥æ˜¯ä¸å¤Ÿçš„ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬è€ƒè™‘ä½¿ç”¨è›‡å½¢æ ¼å¼å°†æˆ‘ä»¬çš„é“¾æ¥åˆ†æˆå‡ ä¸ªéƒ¨åˆ†çš„é€‰é¡¹ã€‚

```ts
import pinataSDK from "@pinata/sdk";
import { readdirSync } from "fs";
import { writeFile, readFile } from "fs/promises";
import path from "path";

export async function uploadFolderToIPFS(folderPath: string): Promise<string> {
  const pinata = new pinataSDK({
    pinataApiKey: process.env.PINATA_API_KEY,
    pinataSecretApiKey: process.env.PINATA_API_SECRET,
  });

  const response = await pinata.pinFromFS(folderPath);
  return response.IpfsHash;
}

export async function updateMetadataFiles(metadataFolderPath: string, imagesIpfsHash: string): Promise<void> {
  const files = readdirSync(metadataFolderPath);

  files.forEach(async (filename, index) => {
    const filePath = path.join(metadataFolderPath, filename)
    const file = await readFile(filePath);
    
    const metadata = JSON.parse(file.toString());
    metadata.image =
      index != files.length - 1
        ? `ipfs://${imagesIpfsHash}/${index}.jpg`
        : `ipfs://${imagesIpfsHash}/logo.jpg`;
    
    await writeFile(filePath, JSON.stringify(metadata));
  });
}
```

å¤ªå¥½äº†ï¼Œè®©æˆ‘ä»¬åœ¨æˆ‘ä»¬çš„ app.ts æ–‡ä»¶ä¸­è°ƒç”¨è¿™äº›æ–¹æ³•ã€‚
æ·»åŠ æˆ‘ä»¬å‡½æ•°çš„å¯¼å…¥ï¼š

```ts
import { updateMetadataFiles, uploadFolderToIPFS } from "./src/metadata";
```

ä¿å­˜å…ƒæ•°æ®/å›¾ç‰‡æ–‡ä»¶å¤¹è·¯å¾„å˜é‡å¹¶è°ƒç”¨æˆ‘ä»¬çš„å‡½æ•°ä¸Šä¼ å…ƒæ•°æ®ã€‚

```ts
async function init() {
  const metadataFolderPath = "./data/metadata/";
  const imagesFolderPath = "./data/images/";

  const wallet = await openWallet(process.env.MNEMONIC!.split(" "), true);

  console.log("Started uploading images to IPFS...");
  const imagesIpfsHash = await uploadFolderToIPFS(imagesFolderPath);
  console.log(
    `Successfully uploaded the pictures to ipfs: https://gateway.pinata.cloud/ipfs/${imagesIpfsHash}`
  );

  console.log("Started uploading metadata files to IPFS...");
  await updateMetadataFiles(metadataFolderPath, imagesIpfsHash);
  const metadataIpfsHash = await uploadFolderToIPFS(metadataFolderPath);
  console.log(
    `Successfully uploaded the metadata to ipfs: https://gateway.pinata.cloud/ipfs/${metadataIpfsHash}`
  );
}
```

ä¹‹åä½ å¯ä»¥è¿è¡Œ `yarn start` å¹¶æŸ¥çœ‹éƒ¨ç½²çš„å…ƒæ•°æ®é“¾æ¥ï¼

### ğŸš¢ éƒ¨ç½² NFT é›†åˆ

å½“æˆ‘ä»¬çš„å…ƒæ•°æ®å·²ç»å‡†å¤‡å¥½å¹¶ä¸”å·²ç»ä¸Šä¼ åˆ°IPFSæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹éƒ¨ç½²æˆ‘ä»¬çš„é›†åˆäº†ï¼

æˆ‘ä»¬å°†åœ¨ `/contracts/NftCollection.ts` æ–‡ä»¶ä¸­åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å°†å­˜å‚¨ä¸æˆ‘ä»¬çš„é›†åˆç›¸å…³çš„æ‰€æœ‰é€»è¾‘ã€‚æˆ‘ä»¬å°†ä»å¯¼å…¥å¼€å§‹ï¼š

```ts
function bufferToChunks(buff: Buffer, chunkSize: number) {
  const chunks: Buffer[] = [];
  while (buff.byteLength > 0) {
    chunks.push(buff.subarray(0, chunkSize));
    buff = buff.subarray(chunkSize);
  }
  return chunks;
}
```

å¹¶å£°æ˜ä¸€ä¸ªç±»å‹ï¼Œå®ƒå°†æè¿°æˆ‘ä»¬é›†åˆæ‰€éœ€çš„åˆå§‹åŒ–æ•°æ®ï¼š

```ts
function makeSnakeCell(data: Buffer): Cell {
  const chunks = bufferToChunks(data, 127);

  if (chunks.length === 0) {
    return beginCell().endCell();
  }

  if (chunks.length === 1) {
    return beginCell().storeBuffer(chunks[0]).endCell();
  }

  let curCell = beginCell();

  for (let i = chunks.length - 1; i >= 0; i--) {
    const chunk = chunks[i];

    curCell.storeBuffer(chunk);

    if (i - 1 >= 0) {
      const nextCell = beginCell();
      nextCell.storeRef(curCell);
      curCell = nextCell;
    }
  }

  return curCell.endCell();
}
```

æœ€åï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œä½¿ç”¨è¿™äº›å‡½æ•°å°†ç¦»çº¿å†…å®¹ç¼–ç ä¸ºcellï¼š

```ts
export function encodeOffChainContent(content: string) {
  let data = Buffer.from(content);
  const offChainPrefix = Buffer.from([0x01]);
  data = Buffer.concat([offChainPrefix, data]);
  return makeSnakeCell(data);
}
```

## ğŸš¢ éƒ¨ç½² NFT é›†åˆ

åœ¨è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬åªæ˜¯ä»é›†åˆæ™ºèƒ½åˆçº¦çš„base64è¡¨ç¤ºä¸­è¯»å–cellã€‚

å‰©ä¸‹çš„åªæœ‰æˆ‘ä»¬é›†åˆåˆå§‹åŒ–æ•°æ®çš„celläº†ã€‚

```ts
import {
  Address,
  Cell,
  internal,
  beginCell,
  contractAddress,
  StateInit,
  SendMode,
} from "@ton/core";
import { encodeOffChainContent, OpenedWallet } from "../utils";
```

å¹¶å£°æ˜ä¸€ä¸ªç±»å‹ï¼Œå®ƒå°†æè¿°æˆ‘ä»¬é›†åˆæ‰€éœ€çš„åˆå§‹åŒ–æ•°æ®ï¼š

```ts
export type collectionData = {
  ownerAddress: Address;
  royaltyPercent: number;
  royaltyAddress: Address;
  nextItemIndex: number;
  collectionContentUrl: string;
  commonContentUrl: string;
}
```

| åç§°                   | è§£é‡Š                             |
| -------------------- | ------------------------------ |
| ownerAddress         | å°†è¢«è®¾ç½®ä¸ºæˆ‘ä»¬é›†åˆçš„æ‰€æœ‰è€…çš„åœ°å€ã€‚åªæœ‰æ‰€æœ‰è€…èƒ½å¤Ÿé“¸é€ æ–°NFT |
| royaltyPercent       | æ¯æ¬¡é”€å”®é‡‘é¢çš„ç™¾åˆ†æ¯”ï¼Œå°†è½¬åˆ°æŒ‡å®šåœ°å€             |
| royaltyAddress       | å°†ä»è¿™ä¸ªNFTé›†åˆçš„é”€å”®ä¸­æ¥æ”¶ç‰ˆç¨çš„é’±åŒ…åœ°å€         |
| nextItemIndex        | ä¸‹ä¸€ä¸ªNFTé¡¹ç›®åº”è¯¥æœ‰çš„ç´¢å¼•                 |
| collectionContentUrl | é›†åˆå…ƒæ•°æ®çš„URL                      |
| commonContentUrl     | NFTé¡¹ç›®å…ƒæ•°æ®çš„åŸºç¡€URL                 |

ä¹‹åï¼Œæˆ‘ä»¬åªæ˜¯åˆ›å»ºNFTé¡¹ç›®çš„ä»£ç cellï¼Œè¿™äº›é¡¹ç›®å°†åœ¨æˆ‘ä»¬çš„æ”¶è—ä¸­è¢«åˆ›å»ºï¼Œå¹¶åœ¨dataCellä¸­å­˜å‚¨å¯¹è¿™ä¸ªcellçš„å¼•ç”¨ã€‚

```ts
export class NftCollection {
  private collectionData: collectionData;

  constructor(collectionData: collectionData) {
    this.collectionData = collectionData;
  }

  private createCodeCell(): Cell {
    const NftCollectionCodeBoc =
      "te6cckECFAEAAh8AART/APSkE/S88sgLAQIBYgkCAgEgBAMAJbyC32omh9IGmf6mpqGC3oahgsQCASAIBQIBIAcGAC209H2omh9IGmf6mpqGAovgngCOAD4AsAAvtdr9qJofSBpn+pqahg2IOhph+mH/SAYQAEO4tdMe1E0PpA0z/U1NQwECRfBNDUMdQw0HHIywcBzxbMyYAgLNDwoCASAMCwA9Ra8ARwIfAFd4AYyMsFWM8WUAT6AhPLaxLMzMlx+wCAIBIA4NABs+QB0yMsCEsoHy//J0IAAtAHIyz/4KM8WyXAgyMsBE/QA9ADLAMmAE59EGOASK3wAOhpgYC42Eit8H0gGADpj+mf9qJofSBpn+pqahhBCDSenKgpQF1HFBuvgoDoQQhUZYBWuEAIZGWCqALnixJ9AQpltQnlj+WfgOeLZMAgfYBwGyi544L5cMiS4ADxgRLgAXGBEuAB8YEYGYHgAkExIREAA8jhXU1DAQNEEwyFAFzxYTyz/MzMzJ7VTgXwSED/LwACwyNAH6QDBBRMhQBc8WE8s/zMzMye1UAKY1cAPUMI43gED0lm+lII4pBqQggQD6vpPywY/egQGTIaBTJbvy9AL6ANQwIlRLMPAGI7qTAqQC3gSSbCHis+YwMlBEQxPIUAXPFhPLP8zMzMntVABgNQLTP1MTu/LhklMTugH6ANQwKBA0WfAGjhIBpENDyFAFzxYTyz/MzMzJ7VSSXwXiN0CayQ==";
    return Cell.fromBase64(NftCollectionCodeBoc);
  }
}
```

ç‰ˆç¨å‚æ•°é€šè¿‡royaltyFactorã€royaltyBaseã€royaltyAddressåœ¨æ™ºèƒ½åˆçº¦ä¸­å­˜å‚¨ã€‚ç‰ˆç¨ç™¾åˆ†æ¯”å¯ä»¥ç”¨å…¬å¼`(royaltyFactor / royaltyBase) * 100%`è®¡ç®—ã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬çŸ¥é“royaltyPercentï¼Œè·å–royaltyFactorå°±ä¸æ˜¯é—®é¢˜ã€‚

å¥½äº†ï¼Œç°åœ¨åªå‰©ä¸‹å«æœ‰æˆ‘ä»¬çš„é›†åˆçš„åˆå§‹æ•°æ®çš„ cell äº†ã€‚
åŸºæœ¬ä¸Šï¼Œæˆ‘ä»¬åªéœ€è¦ä»¥æ­£ç¡®çš„æ–¹å¼å­˜å‚¨ collectionData ä¸­çš„æ•°æ®ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªç©º cell ï¼Œå¹¶åœ¨å…¶ä¸­å­˜å‚¨é›†åˆæ‰€æœ‰è€…åœ°å€å’Œä¸‹ä¸€ä¸ªè¦ç”Ÿæˆçš„é¡¹ç›®çš„ç´¢å¼•ã€‚è®©æˆ‘ä»¬ç¼–å†™ä¸‹ä¸€ä¸ªç§æœ‰æ–¹æ³•ï¼š

```ts
private createDataCell(): Cell {
  const data = this.collectionData;
  const dataCell = beginCell();

  dataCell.storeAddress(data.ownerAddress);
  dataCell.storeUint(data.nextItemIndex, 64);
```

ä¹‹åï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç©º cell æ¥å­˜å‚¨æˆ‘ä»¬çš„é›†åˆå†…å®¹ï¼Œç„¶åå°† ref ä¿å­˜åˆ°åŒ…å«é›†åˆç¼–ç å†…å®¹çš„ cell ä¸­ã€‚ç„¶åå°† ref ä¿å­˜åˆ°ä¸»æ•°æ® cell ä¸­çš„ contentCellã€‚

```ts
const contentCell = beginCell();

const collectionContent = encodeOffChainContent(data.collectionContentUrl);

const commonContent = beginCell();
commonContent.storeBuffer(Buffer.from(data.commonContentUrl));

contentCell.storeRef(collectionContent);
contentCell.storeRef(commonContent.asCell());
dataCell.storeRef(contentCell);
```

ä¹‹åï¼Œæˆ‘ä»¬åªéœ€åˆ›å»º NFT é¡¹ç›®ä»£ç çš„ cell ï¼ˆå°†åœ¨æˆ‘ä»¬çš„é›†åˆä¸­åˆ›å»ºï¼‰ï¼Œå¹¶å°†è¯¥ cell çš„å¼•ç”¨å­˜å‚¨åœ¨ dataCell ä¸­ã€‚

```ts
const NftItemCodeCell = Cell.fromBase64(
  "te6cckECDQEAAdAAART/APSkE/S88sgLAQIBYgMCAAmhH5/gBQICzgcEAgEgBgUAHQDyMs/WM8WAc8WzMntVIAA7O1E0NM/+kAg10nCAJp/AfpA1DAQJBAj4DBwWW1tgAgEgCQgAET6RDBwuvLhTYALXDIhxwCSXwPg0NMDAXGwkl8D4PpA+kAx+gAxcdch+gAx+gAw8AIEs44UMGwiNFIyxwXy4ZUB+kDUMBAj8APgBtMf0z+CEF/MPRRSMLqOhzIQN14yQBPgMDQ0NTWCEC/LJqISuuMCXwSED/LwgCwoAcnCCEIt3FzUFyMv/UATPFhAkgEBwgBDIywVQB88WUAX6AhXLahLLH8s/Im6zlFjPFwGRMuIByQH7AAH2UTXHBfLhkfpAIfAB+kDSADH6AIIK+vCAG6EhlFMVoKHeItcLAcMAIJIGoZE24iDC//LhkiGOPoIQBRONkchQCc8WUAvPFnEkSRRURqBwgBDIywVQB88WUAX6AhXLahLLH8s/Im6zlFjPFwGRMuIByQH7ABBHlBAqN1viDACCAo41JvABghDVMnbbEDdEAG1xcIAQyMsFUAfPFlAF+gIVy2oSyx/LPyJus5RYzxcBkTLiAckB+wCTMDI04lUC8ANqhGIu"
);
dataCell.storeRef(NftItemCodeCell);
```

æ™ºèƒ½åˆçº¦ä¸­å­˜å‚¨çš„ç‰ˆç¨å‚æ•°åŒ…æ‹¬ royaltyFactorã€royaltyBase å’Œ royaltyAddressã€‚ç‰ˆç¨ç™¾åˆ†æ¯”å¯ä»¥ç”¨å…¬å¼ `(royaltyFactor / royaltyBase) * 100%` è®¡ç®—ã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬çŸ¥é“ royaltyPercentï¼Œé‚£ä¹ˆè·å– royaltyFactor å°±ä¸æˆé—®é¢˜äº†ã€‚

```ts
const royaltyBase = 1000;
const royaltyFactor = Math.floor(data.royaltyPercent * royaltyBase);
```

è®¡ç®—å®Œæˆåï¼Œæˆ‘ä»¬éœ€è¦åœ¨å•ç‹¬çš„ cell ä¸­å­˜å‚¨ç‰ˆç¨æ•°æ®ï¼Œå¹¶åœ¨ dataCell ä¸­æä¾›è¯¥ cell çš„å¼•ç”¨ã€‚

```ts
const royaltyCell = beginCell();
royaltyCell.storeUint(royaltyFactor, 16);
royaltyCell.storeUint(royaltyBase, 16);
royaltyCell.storeAddress(data.royaltyAddress);
dataCell.storeRef(royaltyCell);

return dataCell.endCell();
}
```

å½“æ‰€æœ‰è€…é“¸é€ æ–°çš„NFTæ—¶ï¼Œé›†åˆæ¥å—æ‰€æœ‰è€…çš„æ¶ˆæ¯å¹¶å‘åˆ›å»ºçš„NFTæ™ºèƒ½åˆçº¦å‘é€æ–°æ¶ˆæ¯ï¼ˆè¿™éœ€è¦æ”¯ä»˜è´¹ç”¨ï¼‰ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªæ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°†æ ¹æ®é“¸é€ çš„nftsæ•°é‡æ¥è¡¥å……é›†åˆçš„ä½™é¢ï¼š

```ts
public get stateInit(): StateInit {
  const code = this.createCodeCell();
  const data = this.createDataCell();

  return { code, data };
}
```

å®Œç¾ï¼Œç°åœ¨è®©æˆ‘ä»¬åœ¨`app.ts`ä¸­æ·»åŠ å‡ è¡Œï¼Œéƒ¨ç½²æ–°çš„æ”¶è—ï¼š

```ts
public get address(): Address {
    return contractAddress(0, this.stateInit);
  }
```

ç°åœ¨åªå‰©ä¸‹ç¼–å†™å°†æ™ºèƒ½åˆçº¦éƒ¨ç½²åˆ°åŒºå—é“¾ä¸Šçš„æ–¹æ³•äº†ï¼

```ts
public async deploy(wallet: OpenedWallet) {
    const seqno = await wallet.contract.getSeqno();
    await wallet.contract.sendTransfer({
      seqno,
      secretKey: wallet.keyPair.secretKey,
      messages: [
        internal({
          value: "0.05",
          to: this.address,
          init: this.stateInit,
        }),
      ],
      sendMode: SendMode.PAY_GAS_SEPARATELY + SendMode.IGNORE_ERRORS,
    });
    return seqno;
  }
```

æ„å¤–åœ°ï¼Œä½†ç°åœ¨æˆ‘ä»¬éœ€è¦å›åˆ°`NftCollection.ts`ã€‚å¹¶åœ¨æ–‡ä»¶é¡¶éƒ¨çš„`collectionData`é™„è¿‘æ·»åŠ æ­¤ç±»å‹ã€‚

å½“æ‰€æœ‰è€…é“¸å¸ä¸€ä¸ªæ–°çš„ NFT æ—¶ï¼Œé›†åˆä¼šæ¥å—æ‰€æœ‰è€…çš„ä¿¡æ¯ï¼Œå¹¶å‘åˆ›å»ºçš„ NFT æ™ºèƒ½åˆçº¦å‘é€ä¸€ä¸ªæ–°ä¿¡æ¯ï¼ˆè¿™éœ€è¦æ”¯ä»˜ä¸€å®šçš„è´¹ç”¨ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¥å†™ä¸€ä¸ªæ–¹æ³•ï¼Œæ ¹æ®é“¸å¸çš„ NFT æ•°é‡æ¥è¡¥å……é›†åˆçš„ä½™é¢ï¼š

```ts
public async topUpBalance(
    wallet: OpenedWallet,
    nftAmount: number
  ): Promise<number> {
    const feeAmount = 0.026 // approximate value of fees for 1 transaction in our case 
    const seqno = await wallet.contract.getSeqno();
    const amount = nftAmount * feeAmount;

    await wallet.contract.sendTransfer({
      seqno,
      secretKey: wallet.keyPair.secretKey,
      messages: [
        internal({
          value: amount.toString(),
          to: this.address.toString({ bounceable: false }),
          body: new Cell(),
        }),
      ],
      sendMode: SendMode.PAY_GAS_SEPARATELY + SendMode.IGNORE_ERRORS,
    });

    return seqno;
  }
```

å¹¶åœ¨NftCollectionç±»ä¸­åˆ›å»ºä¸€ä¸ªæ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°†æ„å»ºéƒ¨ç½²æˆ‘ä»¬NFTé¡¹ç›®çš„ä¸»ä½“ã€‚é¦–å…ˆå­˜å‚¨ä¸€ä¸ªä½ï¼Œè¯¥ä½å°†æŒ‡ç¤ºç»™é›†åˆæ™ºèƒ½åˆçº¦æˆ‘ä»¬æƒ³è¦åˆ›å»ºæ–°çš„NFTã€‚ä¹‹ååªå­˜å‚¨æ­¤NFTé¡¹ç›®çš„queryIdå’Œç´¢å¼•ã€‚

```ts
import { waitSeqno } from "./delay";
import { NftCollection } from "./contracts/NftCollection";
```

éšååˆ›å»ºä¸€ä¸ªç©ºcellå¹¶åœ¨å…¶ä¸­å­˜å‚¨è¿™ä¸ªNFTçš„æ‰€æœ‰è€…åœ°å€ï¼š

```ts
console.log("Start deploy of nft collection...");
const collectionData = {
  ownerAddress: wallet.contract.address,
  royaltyPercent: 0.05, // 0.05 = 5%
  royaltyAddress: wallet.contract.address,
  nextItemIndex: 0,
  collectionContentUrl: `ipfs://${metadataIpfsHash}/collection.json`,
  commonContentUrl: `ipfs://${metadataIpfsHash}/`,
};
const collection = new NftCollection(collectionData);
let seqno = await collection.deploy(wallet);
console.log(`Collection deployed: ${collection.address}`);
await waitSeqno(seqno, wallet);
```

## ğŸš¢ éƒ¨ç½² NFT é¡¹ç›®

å½“æˆ‘ä»¬çš„é›†åˆå‡†å¤‡å°±ç»ªæ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹é“¸é€ æˆ‘ä»¬çš„ NFT äº†ï¼æˆ‘ä»¬å°†åœ¨ `src/contracts/NftItem.ts` ä¸­å­˜å‚¨ä»£ç 

åœ¨æˆ‘ä»¬çš„ä¸»ä½“cellä¸­å­˜å‚¨å¯¹å¸¦æœ‰é¡¹ç›®å†…å®¹çš„cellçš„å¼•ç”¨ï¼š

```ts
export type mintParams = {
  queryId: number | null,
  itemOwnerAddress: Address,
  itemIndex: number,
  amount: bigint,
  commonContentUrl: string
}
```

| åç§°               | è¯´æ˜                                                          |
| ---------------- | ----------------------------------------------------------- |
| itemOwnerAddress | å°†è¢«è®¾ç½®ä¸ºç‰©å“æ‰€æœ‰è€…çš„åœ°å€                                               |
| itemIndex        | NFT é¡¹ç›®ç´¢å¼•                                                    |
| amount           | å°†å‘é€åˆ° NFT çš„ TON ä½æ•°é‡ï¼Œå¹¶è¿›è¡Œéƒ¨ç½²                                    |
| commonContentUrl | é¡¹ç›® URL çš„å®Œæ•´é“¾æ¥å¯æ˜¾ç¤ºä¸ºé›†åˆçš„ "commonContentUrl" + æ­¤ commonContentUrl |

ç„¶ååœ¨ NftCollection ç±»ä¸­åˆ›å»ºæ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°†æ„å»ºéƒ¨ç½² NFT é¡¹ç›®çš„ä¸»ä½“ã€‚é¦–å…ˆå­˜å‚¨ä½ï¼Œå‘é›†åˆæ™ºèƒ½åˆçº¦è¡¨æ˜æˆ‘ä»¬è¦åˆ›å»ºæ–°çš„ NFTã€‚ç„¶åï¼Œåªéœ€å­˜å‚¨æ­¤ NFT é¡¹ç›®çš„ queryId å’Œç´¢å¼•ã€‚

```ts
public createMintBody(params: mintParams): Cell {
    const body = beginCell();
    body.storeUint(1, 32);
    body.storeUint(params.queryId || 0, 64);
    body.storeUint(params.itemIndex, 64);
    body.storeCoins(params.amount);
```

ä»åˆ›å»ºå®¢æˆ·ç«¯å˜é‡å¼€å§‹ï¼Œå®ƒå°†å¸®åŠ©æˆ‘ä»¬è°ƒç”¨é›†åˆçš„getæ–¹æ³•ã€‚

```ts
    const nftItemContent = beginCell();
    nftItemContent.storeAddress(params.itemOwnerAddress);
```

ç„¶åæˆ‘ä»¬å°†è°ƒç”¨é›†åˆçš„getæ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°†è¿”å›æ­¤é›†åˆä¸­å…·æœ‰è¯¥ç´¢å¼•çš„NFTçš„åœ°å€

```ts
    const uriContent = beginCell();
    uriContent.storeBuffer(Buffer.from(params.commonContentUrl));
    nftItemContent.storeRef(uriContent.endCell());
```

... å¹¶è§£æè¿™ä¸ªåœ°å€ï¼

```ts
    body.storeRef(nftItemContent.endCell());
    return body.endCell();
}
```

ç°åœ¨ï¼Œè®©æˆ‘ä»¬åœ¨`app.ts`ä¸­æ·»åŠ ä¸€äº›ä»£ç ï¼Œä»¥è‡ªåŠ¨åŒ–æ¯ä¸ªNFTçš„é“¸é€ è¿‡ç¨‹ã€‚é¦–å…ˆè¯»å–åŒ…å«æˆ‘ä»¬å…ƒæ•°æ®çš„æ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰æ–‡ä»¶ï¼š

```ts
import { internal, SendMode, Address, beginCell, Cell, toNano } from "@ton/core";
import { OpenedWallet } from "utils";
import { NftCollection, mintParams } from "./NftCollection";
import { TonClient } from "@ton/ton";

export class NftItem {
  private collection: NftCollection;

  constructor(collection: NftCollection) {
    this.collection = collection;
  }

  public async deploy(
    wallet: OpenedWallet,
    params: mintParams
  ): Promise<number> {
    const seqno = await wallet.contract.getSeqno();
    await wallet.contract.sendTransfer({
      seqno,
      secretKey: wallet.keyPair.secretKey,
      messages: [
        internal({
          value: "0.05",
          to: this.collection.address,
          body: this.collection.createMintBody(params),
        }),
      ],
      sendMode: SendMode.IGNORE_ERRORS + SendMode.PAY_GAS_SEPARATELY,
    });
    return seqno;
  }
}
```

å…¶æ¬¡ï¼Œä¸ºæˆ‘ä»¬çš„æ”¶è—å……å€¼ï¼š

æœ€åï¼Œæˆ‘ä»¬å°†ç¼–å†™ç®€çŸ­æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°†é€šè¿‡å…¶ç´¢å¼•è·å–NFTçš„åœ°å€ã€‚

```ts
static async getAddressByIndex(
  collectionAddress: Address,
  itemIndex: number
): Promise<Address> {
  const client = new TonClient({
    endpoint: "https://testnet.toncenter.com/api/v2/jsonRPC",
    apiKey: process.env.TONCENTER_API_KEY,
  });
```

ç„¶åï¼Œæˆ‘ä»¬å°†è°ƒç”¨é›†åˆçš„ get-methodï¼Œè¯¥æ–¹æ³•å°†è¿”å›è¯¥é›†åˆä¸­ NFT çš„åœ°å€ï¼Œå…¶ç´¢å¼•ä¸º

```ts
  const response = await client.runMethod(
    collectionAddress,
    "get_nft_address_by_index",
    [{ type: "int", value: BigInt(itemIndex) }]
  );
```

ä¸ºäº†å°†nftå‡ºå”®ï¼Œæˆ‘ä»¬éœ€è¦ä¸¤ä¸ªæ™ºèƒ½åˆçº¦ã€‚

```ts
    return response.stack.readAddress();
}
```

ç°åœ¨ï¼Œè®©æˆ‘ä»¬åœ¨ `app.ts` ä¸­æ·»åŠ ä¸€äº›ä»£ç ï¼Œä»¥è‡ªåŠ¨æ‰§è¡Œæ¯ä¸ª NFT çš„é€ å¸è¿‡ç¨‹ï¼š

```ts
  import { NftItem } from "./contracts/NftItem";
  import { toNano } from '@ton/core';
```

é¦–å…ˆè¯»å–æ–‡ä»¶å¤¹ä¸­å¸¦æœ‰å…ƒæ•°æ®çš„æ‰€æœ‰æ–‡ä»¶ï¼š

```ts
const files = await readdir(metadataFolderPath);
files.pop();
let index = 0;
```

å…¶æ¬¡ï¼Œä¸ºæˆ‘ä»¬çš„æ”¶è—å……å€¼ï¼š

```ts
seqno = await collection.topUpBalance(wallet, files.length);
await waitSeqno(seqno, wallet);
console.log(`Balance top-upped`);
```

æœ€åï¼Œé€šè¿‡å…ƒæ•°æ®æ£€æŸ¥æ¯ä¸ªæ–‡ä»¶ï¼Œåˆ›å»º `NftItem` å®ä¾‹å¹¶è°ƒç”¨éƒ¨ç½²æ–¹æ³•ã€‚ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œç›´åˆ° seqno å¢åŠ ï¼š

```ts
for (const file of files) {
    console.log(`Start deploy of ${index + 1} NFT`);
    const mintParams = {
      queryId: 0,
      itemOwnerAddress: wallet.contract.address,
      itemIndex: index,
      amount: toNano("0.05"),
      commonContentUrl: file,
    };

    const nftItem = new NftItem(collection);
    seqno = await nftItem.deploy(wallet, mintParams);
    console.log(`Successfully deployed ${index + 1} NFT`);
    await waitSeqno(seqno, wallet);
    index++;
  }
```

## ğŸ· å‡ºå”® NFT

ä¸ºäº†å‡ºå”® nftï¼Œæˆ‘ä»¬éœ€è¦ä¸¤ä¸ªæ™ºèƒ½åˆçº¦ã€‚

- å¸‚åœºï¼Œåªè´Ÿè´£åˆ›å»ºæ–°é”€å”®çš„é€»è¾‘
- é”€å”®åˆçº¦ï¼Œè´Ÿè´£è´­ä¹°/å–æ¶ˆé”€å”®çš„é€»è¾‘å…³ç³»

### éƒ¨ç½²å¸‚åœº

é¦–å…ˆè®©æˆ‘ä»¬å£°æ˜æ–°ç±»å‹ï¼Œè¯¥ç±»å‹å°†æè¿°æˆ‘ä»¬é”€å”®æ™ºèƒ½åˆçº¦çš„æ•°æ®ï¼š

```ts
import {
  Address,
  beginCell,
  Cell,
  contractAddress,
  internal,
  SendMode,
  StateInit,
} from "@ton/core";
import { OpenedWallet } from "../utils";

export class NftMarketplace {
  public ownerAddress: Address;

  constructor(ownerAddress: Address) {
    this.ownerAddress = ownerAddress;
  }


  public get stateInit(): StateInit {
    const code = this.createCodeCell();
    const data = this.createDataCell();

    return { code, data };
  }

  private createDataCell(): Cell {
    const dataCell = beginCell();

    dataCell.storeAddress(this.ownerAddress);

    return dataCell.endCell();
  }

  private createCodeCell(): Cell {
    const NftMarketplaceCodeBoc = "te6cckEBBAEAbQABFP8A9KQT9LzyyAsBAgEgAgMAqtIyIccAkVvg0NMDAXGwkVvg+kDtRND6QDASxwXy4ZEB0x8BwAGOK/oAMAHU1DAh+QBwyMoHy//J0Hd0gBjIywXLAljPFlAE+gITy2vMzMlx+wCRW+IABPIwjvfM5w==";
    return Cell.fromBase64(NftMarketplaceCodeBoc)
  }
}
```

ç°åœ¨è®©æˆ‘ä»¬åˆ›å»ºç±»ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªåŸºæœ¬æ–¹æ³•ï¼Œç”¨äºä¸ºæˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦åˆ›å»ºåˆå§‹åŒ–æ•°æ®cellã€‚

```ts
public get address(): Address {
    return contractAddress(0, this.stateInit);
  }
```

ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºéƒ¨ç½²æˆ‘ä»¬çš„å¸‚åœºï¼š

```ts
public async deploy(wallet: OpenedWallet): Promise<number> {
    const seqno = await wallet.contract.getSeqno();
    await wallet.contract.sendTransfer({
      seqno,
      secretKey: wallet.keyPair.secretKey,
      messages: [
        internal({
          value: "0.5",
          to: this.address,
          init: this.stateInit,
        }),
      ],
      sendMode: SendMode.IGNORE_ERRORS + SendMode.PAY_GAS_SEPARATELY,
    });
    return seqno;
  }
```

æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œè¿™æ®µä»£ç ä¸éƒ¨ç½²å…¶ä»–æ™ºèƒ½åˆçº¦ï¼ˆnft-item æ™ºèƒ½åˆçº¦ã€éƒ¨ç½²æ–°çš„é›†åˆï¼‰å¹¶æ— ä¸åŒã€‚å”¯ä¸€ä¸åŒçš„æ˜¯ï¼Œä½ å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æœ€åˆè¡¥å……å¸‚åœºçš„æ•°é‡ä¸æ˜¯ 0.05  TON ï¼Œè€Œæ˜¯ 0.5  TON ã€‚è¿™æ˜¯ä»€ä¹ˆåŸå› å‘¢ï¼Ÿ  å½“éƒ¨ç½²æ–°çš„æ™ºèƒ½é”€å”®åˆçº¦æ—¶ï¼Œå¸‚åœºä¼šæ¥å—è¯·æ±‚ã€å¤„ç†è¯·æ±‚å¹¶å‘æ–°åˆçº¦å‘é€ä¿¡æ¯ï¼ˆæ˜¯çš„ï¼Œè¿™ç§æƒ…å†µä¸ NFT é›†åˆçš„æƒ…å†µç±»ä¼¼ï¼‰ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦ä¸€ç‚¹é¢å¤–çš„è¯­æ°”æ¥æ”¯ä»˜è´¹ç”¨ã€‚

åƒå¾€å¸¸ä¸€æ ·æ·»åŠ æ–¹æ³•ï¼Œè·å–stateInitï¼Œåˆå§‹åŒ–ä»£ç cellå’Œæˆ‘ä»¬æ™ºèƒ½åˆçº¦çš„åœ°å€ã€‚

```ts
import { NftMarketplace } from "./contracts/NftMarketplace";
```

åªå‰©ä¸‹åˆ›å»ºæˆ‘ä»¬å°†å‘é€åˆ°æˆ‘ä»¬å¸‚åœºçš„æ¶ˆæ¯ä»¥éƒ¨ç½²é”€å”®åˆçº¦ï¼Œå¹¶å®é™…å‘é€æ­¤æ¶ˆæ¯

```ts
console.log("Start deploy of new marketplace  ");
const marketplace = new NftMarketplace(wallet.contract.address);
seqno = await marketplace.deploy(wallet);
await waitSeqno(seqno, wallet);
console.log("Successfully deployed new marketplace");
```

### éƒ¨ç½²é”€å”®åˆçº¦

åˆ›å»ºä¸€ä¸ªå¸¦æœ‰æ¶ˆæ¯ä¸»ä½“çš„cellã€‚é¦–å…ˆæˆ‘ä»¬éœ€è¦è®¾ç½®æ“ä½œç ä¸º1ï¼ˆä»¥æŒ‡ç¤ºå¸‚åœºï¼Œæˆ‘ä»¬æƒ³è¦éƒ¨ç½²æ–°çš„é”€å”®æ™ºèƒ½åˆçº¦ï¼‰ã€‚ä¹‹åæˆ‘ä»¬éœ€è¦å­˜å‚¨å°†å‘é€åˆ°æˆ‘ä»¬æ–°é”€å”®æ™ºèƒ½åˆçº¦çš„å¸å€¼ã€‚æœ€åæˆ‘ä»¬éœ€è¦å­˜å‚¨å¯¹æ–°æ™ºèƒ½åˆçº¦çš„stateInitå’Œå°†å‘é€åˆ°è¿™ä¸ªæ–°æ™ºèƒ½åˆçº¦çš„ä¸»ä½“çš„2ä¸ªå¼•ç”¨ã€‚

åœ¨ `/contracts/NftSale.ts` ä¸­åˆ›å»ºæ–°æ–‡ä»¶ã€‚é¦–å…ˆï¼Œè®©æˆ‘ä»¬å£°æ˜æ–°ç±»å‹ï¼Œå®ƒå°†æè¿°æˆ‘ä»¬çš„é”€å”®æ™ºèƒ½åˆçº¦çš„æ•°æ®ï¼š

```ts
import {
  Address,
  beginCell,
  Cell,
  contractAddress,
  internal,
  SendMode,
  StateInit,
  storeStateInit,
  toNano,
} from "@ton/core";
import { OpenedWallet } from "utils";

export type GetGemsSaleData = {
  isComplete: boolean;
  createdAt: number;
  marketplaceAddress: Address;
  nftAddress: Address;
  nftOwnerAddress: Address | null;
  fullPrice: bigint;
  marketplaceFeeAddress: Address;
  marketplaceFee: bigint;
  royaltyAddress: Address;
  royaltyAmount: bigint;
};
```

ç°åœ¨ï¼Œè®©æˆ‘ä»¬åˆ›å»ºç±»å’ŒåŸºæœ¬æ–¹æ³•ï¼Œä¸ºæ™ºèƒ½åˆçº¦åˆ›å»ºåˆå§‹æ•°æ® cell ã€‚

```ts
export class NftSale {
  private data: GetGemsSaleData;

  constructor(data: GetGemsSaleData) {
    this.data = data;
  }
}
```

ç°åœ¨è®©æˆ‘ä»¬åˆ›å»ºç±»ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªåŸºæœ¬æ–¹æ³•ï¼Œç”¨äºä¸ºæˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦åˆ›å»ºåˆå§‹åŒ–æ•°æ®cellã€‚

```ts
private createDataCell(): Cell {
  const saleData = this.data;

  const feesCell = beginCell();

  feesCell.storeAddress(saleData.marketplaceFeeAddress);
  feesCell.storeCoins(saleData.marketplaceFee);
  feesCell.storeAddress(saleData.royaltyAddress);
  feesCell.storeCoins(saleData.royaltyAmount);
```

è½¬åˆ°`NftItem.ts`ï¼Œå¹¶åœ¨NftItemç±»ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„é™æ€æ–¹æ³•ï¼Œç”¨äºåˆ›å»ºæ­¤ç±»æ¶ˆæ¯çš„ä¸»ä½“ï¼š

```ts
  const dataCell = beginCell();

  dataCell.storeUint(saleData.isComplete ? 1 : 0, 1);
  dataCell.storeUint(saleData.createdAt, 32);
  dataCell.storeAddress(saleData.marketplaceAddress);
  dataCell.storeAddress(saleData.nftAddress);
  dataCell.storeAddress(saleData.nftOwnerAddress);
  dataCell.storeCoins(saleData.fullPrice);
  dataCell.storeRef(feesCell.endCell());

  return dataCell.endCell();
}
```

ä¸€å¦‚æ—¢å¾€ï¼Œæ·»åŠ æ–¹æ³•æ¥è·å–æ™ºèƒ½åˆçº¦çš„ stateInitã€init ä»£ç  cell å’Œåœ°å€ã€‚

```ts
public get address(): Address {
  return contractAddress(0, this.stateInit);
}

public get stateInit(): StateInit {
  const code = this.createCodeCell();
  const data = this.createDataCell();

  return { code, data };
}

private createCodeCell(): Cell {
  const NftFixPriceSaleV2CodeBoc =
    "te6cckECDAEAAikAART/APSkE/S88sgLAQIBIAMCAATyMAIBSAUEAFGgOFnaiaGmAaY/9IH0gfSB9AGoYaH0gfQB9IH0AGEEIIySsKAVgAKrAQICzQgGAfdmCEDuaygBSYKBSML7y4cIk0PpA+gD6QPoAMFOSoSGhUIehFqBSkHCAEMjLBVADzxYB+gLLaslx+wAlwgAl10nCArCOF1BFcIAQyMsFUAPPFgH6AstqyXH7ABAjkjQ04lpwgBDIywVQA88WAfoCy2rJcfsAcCCCEF/MPRSBwCCIYAYyMsFKs8WIfoCy2rLHxPLPyPPFlADzxbKACH6AsoAyYMG+wBxVVAGyMsAFcsfUAPPFgHPFgHPFgH6AszJ7VQC99AOhpgYC42EkvgnB9IBh2omhpgGmP/SB9IH0gfQBqGBNgAPloyhFrpOEBWccgGRwcKaDjgskvhHAoomOC+XD6AmmPwQgCicbIiV15cPrpn5j9IBggKwNkZYAK5Y+oAeeLAOeLAOeLAP0BZmT2qnAbE+OAcYED6Y/pn5gQwLCQFKwAGSXwvgIcACnzEQSRA4R2AQJRAkECPwBeA6wAPjAl8JhA/y8AoAyoIQO5rKABi+8uHJU0bHBVFSxwUVsfLhynAgghBfzD0UIYAQyMsFKM8WIfoCy2rLHxnLPyfPFifPFhjKACf6AhfKAMmAQPsAcQZQREUVBsjLABXLH1ADzxYBzxYBzxYB+gLMye1UABY3EDhHZRRDMHDwBTThaBI=";

  return Cell.fromBase64(NftFixPriceSaleV2CodeBoc);
}
```

å‰©ä¸‹çš„å°±æ˜¯æˆ‘ä»¬è¦å‘å¸‚åœºå‘é€ä¸€æ¡ä¿¡æ¯ï¼Œä»¥éƒ¨ç½²é”€å”®åˆçº¦ï¼Œå¹¶å®é™…å‘é€ä»¥ä¸‹ä¿¡æ¯

å¹¶åˆ›å»ºä¸€ä¸ªè½¬ç§»NFTçš„å‡½æ•°ã€‚

```ts
public async deploy(wallet: OpenedWallet): Promise<number> {
    const stateInit = beginCell()
      .store(storeStateInit(this.stateInit))
      .endCell();
```

å¾ˆå¥½ï¼Œç°åœ¨æˆ‘ä»¬å·²ç»éå¸¸æ¥è¿‘ç»“æŸäº†ã€‚å›åˆ°`app.ts`ï¼Œè®©æˆ‘ä»¬è·å–æˆ‘ä»¬æƒ³è¦å‡ºå”®çš„nftçš„åœ°å€ï¼š

```ts
  const payload = beginCell();
  payload.storeUint(1, 32);
  payload.storeCoins(toNano("0.05"));
  payload.storeRef(stateInit);
  payload.storeRef(new Cell());
```

åˆ›å»ºä¸€ä¸ªå°†å­˜å‚¨æˆ‘ä»¬é”€å”®ä¿¡æ¯çš„å˜é‡ï¼š

```ts
  const seqno = await wallet.contract.getSeqno();
  await wallet.contract.sendTransfer({
    seqno,
    secretKey: wallet.keyPair.secretKey,
    messages: [
      internal({
        value: "0.05",
        to: this.data.marketplaceAddress,
        body: payload.endCell(),
      }),
    ],
    sendMode: SendMode.IGNORE_ERRORS + SendMode.PAY_GAS_SEPARATELY,
  });
  return seqno;
}
```

è¯·æ³¨æ„ï¼Œæˆ‘ä»¬å°†nftOwnerAddressè®¾ç½®ä¸ºnullï¼Œå› ä¸ºå¦‚æœè¿™æ ·åšï¼Œæˆ‘ä»¬çš„é”€å”®åˆçº¦å°†åªæ¥å—æˆ‘ä»¬éƒ¨ç½²æ—¶çš„å¸å€¼ã€‚

### è½¬ç§»ç‰©å“

è½¬è®©ç‰©å“æ„å‘³ç€ä»€ä¹ˆï¼Ÿåªéœ€ä»æ‰€æœ‰è€…çš„é’±åŒ…å‘æ™ºèƒ½åˆçº¦å‘é€ä¸€æ¡ä¿¡æ¯ï¼Œå‘ŠçŸ¥ç‰©å“çš„æ–°æ‰€æœ‰è€…æ˜¯è°å³å¯ã€‚

... å¹¶è¿›è¡Œè½¬ç§»ï¼

è½¬åˆ°`NftItem.ts`ï¼Œå¹¶åœ¨NftItemç±»ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„é™æ€æ–¹æ³•ï¼Œç”¨äºåˆ›å»ºæ­¤ç±»æ¶ˆæ¯çš„ä¸»ä½“ï¼š

```ts
static createTransferBody(params: {
    newOwner: Address;
    responseTo?: Address;
    forwardAmount?: bigint;
  }): Cell {
    const msgBody = beginCell();
    msgBody.storeUint(0x5fcc3d14, 32); // op-code 
    msgBody.storeUint(0, 64); // query-id
    msgBody.storeAddress(params.newOwner);
```

é™¤äº†æ“ä½œç ã€æŸ¥è¯¢ ID å’Œæ–°æ‰€æœ‰è€…çš„åœ°å€å¤–ï¼Œæˆ‘ä»¬è¿˜å¿…é¡»å­˜å‚¨ç¡®è®¤è½¬è´¦æˆåŠŸçš„å›å¤åœ°å€å’Œå…¶ä»–ä¼ å…¥ä¿¡æ¯çš„å¸å€¼ã€‚æ–°æ‰€æœ‰è€…å°†æ”¶åˆ°çš„ TON æ•°é‡ä»¥åŠä»–æ˜¯å¦ä¼šæ”¶åˆ°æ–‡æœ¬æœ‰æ•ˆè½½è·ã€‚

```ts
  msgBody.storeAddress(params.responseTo || null);
  msgBody.storeBit(false); // no custom payload
  msgBody.storeCoins(params.forwardAmount || 0);
  msgBody.storeBit(0); // no forward_payload 

  return msgBody.endCell();
}
```

å¹¶åˆ›å»ºä¸€ä¸ªè½¬ç§»å‡½æ•°æ¥è½¬ç§» NFTã€‚

```ts
static async transfer(
    wallet: OpenedWallet,
    nftAddress: Address,
    newOwner: Address
  ): Promise<number> {
    const seqno = await wallet.contract.getSeqno();

    await wallet.contract.sendTransfer({
      seqno,
      secretKey: wallet.keyPair.secretKey,
      messages: [
        internal({
          value: "0.05",
          to: nftAddress,
          body: this.createTransferBody({
            newOwner,
            responseTo: wallet.contract.address,
            forwardAmount: toNano("0.02"),
          }),
        }),
      ],
      sendMode: SendMode.IGNORE_ERRORS + SendMode.PAY_GAS_SEPARATELY,
    });
    return seqno;
  }
```

å¾ˆå¥½ï¼Œç°åœ¨æˆ‘ä»¬å·²ç»æ¥è¿‘å°¾å£°äº†ã€‚å›åˆ° `app.ts`ï¼Œæ‰¾åˆ°æˆ‘ä»¬è¦å‡ºå”®çš„ nft çš„åœ°å€ï¼š

```ts
const nftToSaleAddress = await NftItem.getAddressByIndex(collection.address, 0);
```

åˆ›å»ºå˜é‡ï¼Œç”¨äºå­˜å‚¨æˆ‘ä»¬çš„é”€å”®ä¿¡æ¯ã€‚

æ·»åŠ åˆ° `app.ts` çš„å¼€å¤´ï¼š

```ts
import { GetGemsSaleData, NftSale } from "./contracts/NftSale";
```

ç„¶å

```ts
const saleData: GetGemsSaleData = {
  isComplete: false,
  createdAt: Math.ceil(Date.now() / 1000),
  marketplaceAddress: marketplace.address,
  nftAddress: nftToSaleAddress,
  nftOwnerAddress: null,
  fullPrice: toNano("10"),
  marketplaceFeeAddress: wallet.contract.address,
  marketplaceFee: toNano("1"),
  royaltyAddress: wallet.contract.address,
  royaltyAmount: toNano("0.5"),
};
```

è¯·æ³¨æ„ï¼Œæˆ‘ä»¬å°† `nftOwnerAddress` è®¾ç½®ä¸º nullï¼Œå› ä¸ºè¿™æ ·è®¾ç½®åï¼Œæˆ‘ä»¬çš„é”€å”®åˆçº¦åœ¨éƒ¨ç½²æ—¶å°±ä¼šç›´æ¥æ¥æ”¶æˆ‘ä»¬çš„ä»£å¸ã€‚

è¯·æ³¨æ„ï¼Œæˆ‘ä»¬å°†nftOwnerAddressè®¾ç½®ä¸ºnullï¼Œå› ä¸ºå¦‚æœè¿™æ ·åšï¼Œæˆ‘ä»¬çš„é”€å”®åˆçº¦å°†åªæ¥å—æˆ‘ä»¬éƒ¨ç½²æ—¶çš„å¸å€¼ã€‚

```ts
const nftSaleContract = new NftSale(saleData);
seqno = await nftSaleContract.deploy(wallet);
await waitSeqno(seqno, wallet);
```

... å¹¶å°†å…¶è½¬ç§»ï¼

```ts
await NftItem.transfer(wallet, nftToSaleAddress, nftSaleContract.address);
```

ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å¯åŠ¨æˆ‘ä»¬çš„é¡¹ç›®ï¼Œäº«å—è¿™ä¸ªè¿‡ç¨‹ï¼

```
yarn start
```

è¯·è®¿é—® https://testnet.getgems.io/collection/{YOUR_COLLECTION_ADDRESS_HERE}
ï¼Œçœ‹çœ‹è¿™åªå®Œç¾çš„é¸­å­ï¼

## ç»“è¯­

ä»Šå¤©ï¼Œæ‚¨å·²ç»å­¦åˆ°äº†å¾ˆå¤šå…³äº TON çš„æ–°çŸ¥è¯†ï¼Œç”šè‡³è¿˜åœ¨ testnet ä¸­åˆ›å»ºäº†è‡ªå·±æ¼‚äº®çš„ NFT å¥—ä»¶ï¼å¦‚æœæ‚¨ä»æœ‰ä»»ä½•ç–‘é—®æˆ–å‘ç°é”™è¯¯ï¼Œè¯·éšæ—¶å‘æ¶ˆæ¯ç»™ä½œè€… - [@coalus](https://t.me/coalus)

## å‚è€ƒèµ„æ–™

- [GetGems NFT-contracts](https://github.com/getgems-io/nft-contracts)
- [NFTæ ‡å‡†](https://github.com/ton-blockchain/TEPs/blob/master/text/0062-nft-standard.md)

## å…³äºä½œè€…

- Coalusï¼š[Telegram](https://t.me/coalus) æˆ– [GitHub](https://github.com/coalus)

## å¦è¯·å‚è§

- [NFT ç”¨ä¾‹](/v3/documentation/dapps/defi/nft)
