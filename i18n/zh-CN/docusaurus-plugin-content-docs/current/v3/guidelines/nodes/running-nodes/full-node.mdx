import Feedback from '@site/src/components/Feedback';

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Full node

## 操作系统要求

We highly recommend installing MyTonCtrl using the supported operating systems:

- Ubuntu 20.04
- Ubuntu 22.04
- Debian 11

## Hardware requirements

:::caution 个人本地计算机的节点使用情况
You shouldn't run any type of node on your personal local machine for extended periods, even if it meets the requirements. Nodes actively use disks, which can lead to rapid wear and potential damage.
:::

### With validator

- 16 cores CPU
- 128 GB RAM
- 1TB NVME SSD _OR_ Provisioned 64+k IOPS storage
- 1 Gbit/s 网络连接
- 公共 IP 地址（_固定 IP 地址）
- 64 TB/月流量（峰值负载时为 100 TB/月）

:::info 为高峰负荷做好准备
To reliably handle peak loads, a connection of at least 1 Gbit/s is typically required, while the average load is expected to be around 100 Mbit/s.
:::

### Port forwarding

All types of nodes require a static external IP address, one UDP port forwarded for incoming connections, and all outgoing connections to be open—the node uses random ports for new outgoing connections. The node must also be visible to the outside world over the NAT.

You can accomplish this by contacting your network provider or [renting a server](/v3/guidelines/nodes/running-nodes/full-node#recommended-providers) to run a node.

:::info
您可以使用 `netstat -tulpn` 命令查看哪个 UDP 端口已打开。
:::

### Recommended providers

TON基金会推荐以下供应商运行验证者：

| Cloud Provider | Instance Type                   | CPU                     | RAM     | Storage                           | Network         | Public IP                               | Traffic       |
| -------------- | ------------------------------- | ----------------------- | ------- | --------------------------------- | --------------- | --------------------------------------- | ------------- |
| GCP            | `n2-standard-16`                | `32 vCPUs`              | `128GB` | `1TB NVMe SSD`                    | `16 Gbps`       | Reserve a static external IP            | `64 TB/month` |
| Alibaba Cloud  | `ecs.g6.4xlarge`                | `32 vCPUs`              | `128GB` | `1TB NVMe SSD`                    | `Up to 10 Gbps` | Bind an Elastic IP                      | `64 TB/month` |
| Tencent Cloud  | `M5.4XLARGE`                    | `32 vCPUs`              | `128GB` | `1TB NVMe SSD`                    | `Up to 10 Gbps` | Associate an Elastic IP                 | `64 TB/month` |
| Vultr          | `bare metal Intel E-2388G`      | `16 Cores / 32 Threads` | `128GB` | `1.92TB NVMe SSD`                 | `10 Gbps`       | Fixed IP address included with instance | `64 TB/month` |
| DigitalOcean   | `general purpose premium Intel` | `32 vCPUs`              | `128GB` | `1TB NVMe SSD`                    | `10 Gbps`       | Fixed IP address included with instance | `64 TB/month` |
| Latitude       | `c3.medium.x86`                 | `16 Cores / 32 Threads` | `128GB` | `1.9TB NVMe SSD`                  | `10 Gbps`       | Fixed IP address included with instance | `64 TB/month` |
| AWS            | `i4i.8xlarge`                   | `32 vCPUs`              | `256GB` | `2 x 3,750 AWS Nitro SSD (fixed)` | `Up to 25 Gbps` | Bind an Elastic IP                      | `64 TB/month` |

:::info
**Note:** Prices, configurations, and availability can change. It is recommended to always refer to the official documentation and pricing pages of the respective cloud provider before making any decisions.
:::

## Run a Node (video)

[//]: # "<ReactPlayer controls={true} style={{borderRadius:'10pt', margin:'15pt auto', maxWidth: '100%'}} url='/docs/files/TON_nodes.mp4' />"

请查看本视频的分步教程，以便及时开始：

<video
  style={{
    borderRadius: "10pt",
    margin: "auto",
    width: "100%",
    maxWidth: "100%",
  }}
  controls={true}
>
  <source src="/files/TON_nodes.mp4" type="video/mp4" />
</video>

## Run a node (text)

### 切换到您的非root用户：

:::warning
This step is required to successfully install and use MyTonCtrl—don't ignore non-root user creation. Without this step, there will be no errors during installation, but MyTonCtrl will not work properly.
:::

If you don't have a non-root user, you can create one with the following steps (otherwise, skip the first two steps and go to the third).

1. 以root用户身份登录并创建新用户：

```bash
sudo adduser <username>
```

2. 将用户添加到 sudo 组：

```bash
sudo usermod -aG sudo <username>
```

3. 登录新用户（如果使用 ssh，**需要停止当前会话，然后使用正确的用户重新连接**）。

```bash
ssh <username>@<server-ip-address>
```

### 安装 MyTonCtrl

从具有 **sudo** 权限的 **非root** 用户账户下载并运行安装脚本：

<Tabs groupId="operating-systems">
  <TabItem value="ubuntu" label="Ubuntu">

```bash
wget https://raw.githubusercontent.com/ton-blockchain/mytonctrl/master/scripts/install.sh
sudo bash install.sh
```

</TabItem>
  <TabItem value={'debian'} label={'Debian'}>

```bash
wget https://raw.githubusercontent.com/ton-blockchain/mytonctrl/master/scripts/install.sh
su root -c 'bash install.sh'
```

</TabItem>
</Tabs>

- `-d` - **mytonctrl** will download a [dump](https://dump.ton.org/) of the latest blockchain state.
  This will reduce synchronization time by several times.
- `-c <path>` - If you want to use not public liteservers for synchronization. _(not required)_
- `-i` - 忽略最低要求，只有在不使用实际节点的情况下检查编译过程时才使用。
- `-m` - 模式，可以是 `validator` 或 `liteserver`。
- `-t` - 禁用遥测功能。

** 要使用 testnet**，应在 `-c` 标志中加入 `https://ton.org/testnet-global.config.json` 值。

默认的 `-c` 标志值为 `https://ton-blockchain.github.io/global.config.json`，这是默认的主网配置。

### Running the MyTonCtrl

1. Run `MyTonCtrl` console **from the local user account used for installation**:

```sh
mytonctrl
```

2. 使用 `status` 命令检查 `MyTonCtrl` 的状态：

```sh
status
```

**在 testnet** 中，必须使用  `status fast` 命令，而不是 `status`。

应显示以下状态：

- **mytoncore status**: should display in green.
- **local validator status**: should also display in green.
- **local validator out of sync**: initially, a `n/a` string is displayed. As soon as the newly created validator connects with other validators, the number will be around 250k. As synchronization progresses, this number decreases. When it falls below 20, the validator is synchronized.

**status** 命令输出示例：

![status](/img/docs/nodes-validator/mytonctrl-status.png)

:::caution 确保状态输出相同
For all nodes type **Local Validator status** section should appear.
所有节点都应显示 **Local Validator status** 部分。
否则，[检查故障排除部分](/v3/guidelines/nodes/nodes-troubleshooting#status-command-displays-without-local-node-section) 和 [检查节点日志](/v3/guidelines/nodes/running-nodes/full-node#check-the-node-logs)。
:::

Please wait until the `Local validator out of sync` status is less than 20 seconds.

When a new node is started, even from a dump, it is important to wait up to 3 hours before the _out of sync_ number begins to decrease. This delay occurs because the node must establish its place in the network and propagate its addresses through the DHT tables, among other processes.

### 卸载 mytonctrl

下载脚本并运行：

```bash
sudo bash /usr/src/mytonctrl/scripts/uninstall.sh
```

### 检查 mytonctrl 所有者

运行：

```bash
ls -lh /var/ton-work/keys/
```

## Tips & tricks

### 可用命令列表

- 您可以使用 `help` 获取可用命令列表：

![Help command](/img/docs/full-node/help.jpg)

### Check the MyTonCtrl logs

- To check **MyTonCtrl** logs, open `~/.local/share/mytoncore/mytoncore.log` for a local user or `/usr/local/bin/mytoncore/mytoncore.log` for root.

![logs](/img/docs/nodes-validator/manual-ubuntu_mytoncore-log.png)

### 检查节点日志

Check the node logs in case of failure:

```bash
tail -f /var/ton-work/log.thread*
```

## 支持

Contact technical support with [@ton_node_help](https://t.me/ton_node_help).

<Feedback />
