---
title: Counter contract in Tolk
---

import Feedback from "@site/src/components/Feedback";

# Counter contract implementation in Tolk

When you create a "counter contract" using `npm create ton@latest`, it creates the following file:

```tolk
tolk 1.0

struct Storage {
    ...
}

fun Storage.load() ...
fun Storage.save(self) ...

struct (0x7e8764ef) IncreaseCounter {
    ...
}
struct (0x3a752f06) ResetCounter {
    ...
}

type AllowedMessage = IncreaseCounter | ResetCounter

fun onInternalMessage(in: InMessage) {
    val msg = lazy AllowedMessage.fromSlice(in.body);

    match (msg) {
        IncreaseCounter => {
            ...
        }
        ResetCounter => {
            ...
        }
        else => {
            ...
        }
    }
}

fun onBouncedMessage(in: InMessageBounced) {
}

get fun currentCounter() ...
get fun initialId() ...
```

Let's explore what's going on here.

### Smart contract data

At first, we declare storage. It represents the exact same format as we're deploying from a TypeScript client `wrappers/Counter.ts`.

```tolk
// in `Counter.ts`, you see a function `counterConfigToCell`,
// which manually constructs two int32 values â€” here they are
struct Storage {
    id: uint32
    counter: uint32
}

// and methods to load/store a struct from the persistent storage

fun Storage.load() {
    return Storage.fromCell(contract.getData())
}
fun Storage.save(self) {
    contract.setData(self.toCell())
}
```

### Handling incoming messages

When you send a message from a client (`wrappers/Counter.ts`, function `sendIncrease` for example), it's handled here:

```tolk
fun onInternalMessage(in: InMessage) {
    val msg = lazy AllowedMessage.fromSlice(in.body);

    match (msg) {
        IncreaseCounter => {
            // ...
        }
        ResetCounter => {
            // ...
        }
        else => {
            // ... unrecognized messages
        }
    }
}
```

Take a look at `sendIncrease` in TypeScript which packs `OP_INCREASE`, `queryID`, and `increaseBy`. 
You see a struct in `counter.tolk` that represents this incoming message:
```tolk
struct (0x7e8764ef) IncreaseCounter {
    queryId: uint64
    increaseBy: uint32
}
```

### Sending messages

In this contract we don't need to send any messages, to learn more, check out [Create message](/v3/documentation/smart-contracts/tolk/tolk-vs-func/create-message.mdx) article.

### Handling internal bounced messages

"Bounced messages" are messages that you _sent_, but they couldn't be handled by a receiver and _returned back_.

```tolk
fun onBouncedMessage(in: InMessageBounced) {
}
```

Since you don't send any messages (only accept increase/reset), leave this function empty or even remove it.

### GET methods

GET methods (or "contract getters") work OFFCHAIN. Typically, they return some data from the storage.

```tolk
get fun currentCounter(): int {
    val storage = lazy Storage.load();
    return storage.counter;
}
```

Take a look at `getCounter` from `wrappers/Counter.ts`: it invokes this exact getter from `counter.tolk`. 

<Feedback />
